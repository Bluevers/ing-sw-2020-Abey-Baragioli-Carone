


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: Gui</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">it.polimi.ingsw.client.view.gui</a> ]
</div>

<h1>Coverage Summary for Class: Gui (it.polimi.ingsw.client.view.gui)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Gui</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 121)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 768)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Gui$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Gui$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Gui$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Gui$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 125)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 772)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;package it.polimi.ingsw.client.view.gui;
<i>2</i>&nbsp;
<i>3</i>&nbsp;import com.google.gson.Gson;
<i>4</i>&nbsp;import com.google.gson.reflect.TypeToken;
<i>5</i>&nbsp;import it.polimi.ingsw.client.Client;
<i>6</i>&nbsp;import it.polimi.ingsw.client.view.View;
<i>7</i>&nbsp;import it.polimi.ingsw.network.CommunicationProtocol;
<i>8</i>&nbsp;import it.polimi.ingsw.network.exceptions.TimeOutException;
<i>9</i>&nbsp;import it.polimi.ingsw.network.objects.MatchStory;
<i>10</i>&nbsp;import it.polimi.ingsw.server.model.Colour;
<i>11</i>&nbsp;import it.polimi.ingsw.network.exceptions.ChannelClosedException;
<i>12</i>&nbsp;import javafx.animation.FadeTransition;
<i>13</i>&nbsp;import it.polimi.ingsw.network.objects.BoxProxy;
<i>14</i>&nbsp;import it.polimi.ingsw.network.objects.GodCardProxy;
<i>15</i>&nbsp;import it.polimi.ingsw.network.objects.PlayerProxy;
<i>16</i>&nbsp;import javafx.animation.KeyFrame;
<i>17</i>&nbsp;import javafx.animation.Timeline;
<i>18</i>&nbsp;import javafx.animation.TranslateTransition;
<i>19</i>&nbsp;import javafx.application.Application;
<i>20</i>&nbsp;import javafx.application.Platform;
<i>21</i>&nbsp;import javafx.collections.FXCollections;
<i>22</i>&nbsp;import javafx.geometry.Insets;
<i>23</i>&nbsp;import javafx.geometry.Pos;
<i>24</i>&nbsp;import javafx.scene.Cursor;
<i>25</i>&nbsp;import javafx.scene.Scene;
<i>26</i>&nbsp;import javafx.scene.control.*;
<i>27</i>&nbsp;import javafx.scene.effect.BoxBlur;
<i>28</i>&nbsp;import javafx.scene.effect.DropShadow;
<i>29</i>&nbsp;import javafx.scene.image.Image;
<i>30</i>&nbsp;import javafx.scene.image.ImageView;
<i>31</i>&nbsp;import javafx.scene.layout.*;
<i>32</i>&nbsp;import javafx.scene.paint.Color;
<i>33</i>&nbsp;import javafx.scene.text.Font;
<i>34</i>&nbsp;import javafx.scene.text.Text;
<i>35</i>&nbsp;import javafx.scene.text.TextAlignment;
<i>36</i>&nbsp;import javafx.stage.Screen;
<i>37</i>&nbsp;import javafx.stage.Stage;
<i>38</i>&nbsp;import javafx.stage.StageStyle;
<i>39</i>&nbsp;import javafx.util.Duration;
<i>40</i>&nbsp;
<i>41</i>&nbsp;import java.lang.reflect.Type;
<i>42</i>&nbsp;import java.util.ArrayList;
<i>43</i>&nbsp;import java.util.List;
<i>44</i>&nbsp;import java.util.concurrent.TimeoutException;
<i>45</i>&nbsp;import java.util.concurrent.atomic.AtomicBoolean;
<i>46</i>&nbsp;
<i>47</i>&nbsp;import static javafx.scene.paint.Color.*;
<i>48</i>&nbsp;
<b class="nc"><i>49</i>&nbsp;public class Gui extends Application implements View {</b>
<i>50</i>&nbsp;
<i>51</i>&nbsp;    //screen width
<b class="nc"><i>52</i>&nbsp;    private double screenWidth = Screen.getPrimary().getBounds().getWidth();</b>
<i>53</i>&nbsp;
<i>54</i>&nbsp;    //screen height
<b class="nc"><i>55</i>&nbsp;    private double screenHeight = Screen.getPrimary().getBounds().getHeight();</b>
<i>56</i>&nbsp;
<i>57</i>&nbsp;    //offset of the window relative to screen width
<i>58</i>&nbsp;    private double xOffset;
<i>59</i>&nbsp;
<i>60</i>&nbsp;    //offset of the window relative to screen height
<i>61</i>&nbsp;    private double yOffset;
<i>62</i>&nbsp;
<i>63</i>&nbsp;    //fonts
<b class="nc"><i>64</i>&nbsp;    private final Font lillybelleFont = Font.loadFont(Gui.class.getResourceAsStream(&quot;/fonts/LillyBelle.ttf&quot;), screenWidth/80);</b>
<b class="nc"><i>65</i>&nbsp;    private final Font settingsFont = Font.loadFont(Gui.class.getResourceAsStream(&quot;/fonts/LillyBelle.ttf&quot;), screenWidth/110);</b>
<i>66</i>&nbsp;
<i>67</i>&nbsp;    //number of rows and columns of the map
<i>68</i>&nbsp;    private static final int mapRowsNumber = 5;
<i>69</i>&nbsp;    private static final int mapColumnsNumber = 5;
<i>70</i>&nbsp;
<i>71</i>&nbsp;    //client
<b class="nc"><i>72</i>&nbsp;    private final Client client = new Client(this);</b>
<i>73</i>&nbsp;
<i>74</i>&nbsp;    //scene of the primary window
<i>75</i>&nbsp;    private Scene fullScene;
<i>76</i>&nbsp;
<i>77</i>&nbsp;    //setting window
<i>78</i>&nbsp;    private Stage settingStage;
<i>79</i>&nbsp;
<i>80</i>&nbsp;    //primary window
<b class="nc"><i>81</i>&nbsp;    private Stage window = null;</b>
<i>82</i>&nbsp;
<i>83</i>&nbsp;    //menu scene
<i>84</i>&nbsp;    private MenuScene menuScene;
<i>85</i>&nbsp;
<i>86</i>&nbsp;    //match scene
<i>87</i>&nbsp;    private MatchScene matchScene;
<i>88</i>&nbsp;
<i>89</i>&nbsp;    //primary window pane
<i>90</i>&nbsp;    private StackPane mainScene;
<i>91</i>&nbsp;
<i>92</i>&nbsp;    //opening page
<b class="nc"><i>93</i>&nbsp;    private final StackPane openingPage = new StackPane();</b>
<i>94</i>&nbsp;
<i>95</i>&nbsp;    //menu page
<i>96</i>&nbsp;    private HBox menuPage;
<i>97</i>&nbsp;
<i>98</i>&nbsp;    //match page
<i>99</i>&nbsp;    private StackPane matchPage;
<i>100</i>&nbsp;
<i>101</i>&nbsp;    //loading page
<b class="nc"><i>102</i>&nbsp;    private StackPane loadingPage = new StackPane();</b>
<i>103</i>&nbsp;
<i>104</i>&nbsp;    //how to play pane
<b class="nc"><i>105</i>&nbsp;    private StackPane howToPlayBox = new StackPane();</b>
<i>106</i>&nbsp;
<i>107</i>&nbsp;    //clouds animation pane
<i>108</i>&nbsp;    private StackPane transitionClouds;
<i>109</i>&nbsp;
<i>110</i>&nbsp;    //close popup pane
<i>111</i>&nbsp;    private StackPane closePopup;
<i>112</i>&nbsp;
<i>113</i>&nbsp;    //connection errors pane
<i>114</i>&nbsp;    private StackPane connectionError;
<i>115</i>&nbsp;
<i>116</i>&nbsp;    //yes choice of popup
<i>117</i>&nbsp;    private Button yesPopupButton;
<i>118</i>&nbsp;
<i>119</i>&nbsp;    //no choice od popup
<i>120</i>&nbsp;    private Button noPopupButton;
<i>121</i>&nbsp;
<i>122</i>&nbsp;    //animations
<i>123</i>&nbsp;    private TranslateTransition translateLeftTransitionIn;
<i>124</i>&nbsp;    private TranslateTransition translateRightTransitionIn;
<i>125</i>&nbsp;
<i>126</i>&nbsp;    //connection variables
<b class="nc"><i>127</i>&nbsp;    private String ip = null;</b>
<b class="nc"><i>128</i>&nbsp;    private int port = -1;</b>
<i>129</i>&nbsp;
<i>130</i>&nbsp;    //player&#39;s infos
<i>131</i>&nbsp;    private String nickname;
<i>132</i>&nbsp;    private String color;
<i>133</i>&nbsp;
<i>134</i>&nbsp;    //match number of players
<i>135</i>&nbsp;    private int numberOfPlayers;
<i>136</i>&nbsp;
<i>137</i>&nbsp;    //opponents for the match
<b class="nc"><i>138</i>&nbsp;    private List&lt;PlayerProxy&gt; opponents = new ArrayList&lt;&gt;();</b>
<i>139</i>&nbsp;
<i>140</i>&nbsp;    //variable that tells if user is doing a new match
<b class="nc"><i>141</i>&nbsp;    private boolean secondMatch = false;</b>
<i>142</i>&nbsp;
<i>143</i>&nbsp;    //settings window form variables
<b class="nc"><i>144</i>&nbsp;    private Text ipForm = new Text (&quot;Ip Address&quot;);;</b>
<i>145</i>&nbsp;    private TextField ipFormField;
<b class="nc"><i>146</i>&nbsp;    private Text portForm = new Text(&quot;Port Number&quot;);</b>
<i>147</i>&nbsp;    private TextField portFormField;
<b class="nc"><i>148</i>&nbsp;    private Button connectionButton = new Button(&quot;Connect&quot;);</b>
<i>149</i>&nbsp;    private ImageView loadingIcon;
<i>150</i>&nbsp;    private Text errorMessage;
<i>151</i>&nbsp;    private Text connectedText;
<i>152</i>&nbsp;    private Button disconnectionButton;
<i>153</i>&nbsp;    private Button enterGameButton;
<i>154</i>&nbsp;
<i>155</i>&nbsp;    //variable that is true when menu page is ready
<b class="nc"><i>156</i>&nbsp;    private  AtomicBoolean gameIsReady = new AtomicBoolean(false);</b>
<i>157</i>&nbsp;
<i>158</i>&nbsp;    //variable that is true when match page is ready
<b class="nc"><i>159</i>&nbsp;    private  AtomicBoolean readyForTheMatch = new AtomicBoolean(false);</b>
<i>160</i>&nbsp;
<i>161</i>&nbsp;    //variable that is true if user clicked &quot;connect&quot; on setting page
<b class="nc"><i>162</i>&nbsp;    private  AtomicBoolean clicked = new AtomicBoolean(false);</b>
<i>163</i>&nbsp;
<i>164</i>&nbsp;    //variable that is true if user clicks on play button in the settings window
<b class="nc"><i>165</i>&nbsp;    private AtomicBoolean openGame = new AtomicBoolean(false);</b>
<i>166</i>&nbsp;
<i>167</i>&nbsp;    //variable that is true if user clicks on disconnect button in the settings window
<b class="nc"><i>168</i>&nbsp;    private AtomicBoolean restartConnection = new AtomicBoolean(false);</b>
<i>169</i>&nbsp;
<i>170</i>&nbsp;    //variable that is true if user closes settings window
<b class="nc"><i>171</i>&nbsp;    private  AtomicBoolean closeWindow = new AtomicBoolean(false);</b>
<i>172</i>&nbsp;
<i>173</i>&nbsp;    //variable that is true if user writes valid ip and port
<b class="nc"><i>174</i>&nbsp;    private AtomicBoolean valid = new AtomicBoolean(false);</b>
<i>175</i>&nbsp;
<i>176</i>&nbsp;    //window size choices
<i>177</i>&nbsp;    private ComboBox screenSizeOptions;
<i>178</i>&nbsp;
<i>179</i>&nbsp;    //text that shows screen size errors
<i>180</i>&nbsp;    private Text screenSizeError;
<i>181</i>&nbsp;
<i>182</i>&nbsp;    //variable that is true when menu scene is displayed
<b class="nc"><i>183</i>&nbsp;    private boolean inMenuPage = false;</b>
<i>184</i>&nbsp;
<i>185</i>&nbsp;    //variable that is true when there is a connection error
<b class="nc"><i>186</i>&nbsp;    private boolean isConnectionError = false;</b>
<i>187</i>&nbsp;
<i>188</i>&nbsp;    //variable that is true when second window is opened
<i>189</i>&nbsp;    private boolean secondWindow;
<i>190</i>&nbsp;
<i>191</i>&nbsp;
<i>192</i>&nbsp;    @Override
<i>193</i>&nbsp;    public void start(Stage settingsStage){
<b class="nc"><i>194</i>&nbsp;        createSettingStage(settingsStage);</b>
<i>195</i>&nbsp;    }
<i>196</i>&nbsp;
<i>197</i>&nbsp;    //-----------------------------------------GETTER--------------------------------------------------
<i>198</i>&nbsp;
<i>199</i>&nbsp;    public Stage window() {
<b class="nc"><i>200</i>&nbsp;        return window;</b>
<i>201</i>&nbsp;    }
<i>202</i>&nbsp;
<i>203</i>&nbsp;    public HBox menuPage(){
<b class="nc"><i>204</i>&nbsp;        return menuPage;</b>
<i>205</i>&nbsp;    }
<i>206</i>&nbsp;
<i>207</i>&nbsp;    public MenuScene menuScene(){
<b class="nc"><i>208</i>&nbsp;        return menuScene;</b>
<i>209</i>&nbsp;    }
<i>210</i>&nbsp;
<i>211</i>&nbsp;    public MatchScene matchScene(){
<b class="nc"><i>212</i>&nbsp;        return matchScene;</b>
<i>213</i>&nbsp;    }
<i>214</i>&nbsp;
<i>215</i>&nbsp;    public int mapRowsNumber() {
<b class="nc"><i>216</i>&nbsp;        return mapRowsNumber;</b>
<i>217</i>&nbsp;    }
<i>218</i>&nbsp;
<i>219</i>&nbsp;    public int mapColumnsNumber() {
<b class="nc"><i>220</i>&nbsp;        return mapColumnsNumber;</b>
<i>221</i>&nbsp;    }
<i>222</i>&nbsp;
<i>223</i>&nbsp;    public int port(){
<b class="nc"><i>224</i>&nbsp;        return port;</b>
<i>225</i>&nbsp;    }
<i>226</i>&nbsp;
<i>227</i>&nbsp;    public Client client(){
<b class="nc"><i>228</i>&nbsp;        return client;</b>
<i>229</i>&nbsp;    }
<i>230</i>&nbsp;
<i>231</i>&nbsp;    //-----------------------------------------END GETTER----------------------------------------------
<i>232</i>&nbsp;
<i>233</i>&nbsp;    //-----------------------------------------SETTER--------------------------------------------------
<i>234</i>&nbsp;
<i>235</i>&nbsp;    public void setIp(String ip){
<b class="nc"><i>236</i>&nbsp;        this.ip = ip;</b>
<i>237</i>&nbsp;    }
<i>238</i>&nbsp;
<i>239</i>&nbsp;    public void setPort(int port){
<b class="nc"><i>240</i>&nbsp;        this.port = port;</b>
<i>241</i>&nbsp;    }
<i>242</i>&nbsp;
<i>243</i>&nbsp;    /**
<i>244</i>&nbsp;     * This method writes errors in settings page
<i>245</i>&nbsp;     * @param message Error to show
<i>246</i>&nbsp;     */
<i>247</i>&nbsp;    private void setErrorMessage(String message){
<b class="nc"><i>248</i>&nbsp;        errorMessage.setVisible(true);</b>
<b class="nc"><i>249</i>&nbsp;        errorMessage.setManaged(true);</b>
<b class="nc"><i>250</i>&nbsp;        errorMessage.setText(message);</b>
<i>251</i>&nbsp;    }
<i>252</i>&nbsp;
<i>253</i>&nbsp;    public void setNewMatch(){
<b class="nc"><i>254</i>&nbsp;        secondMatch = true;</b>
<i>255</i>&nbsp;    }
<i>256</i>&nbsp;
<i>257</i>&nbsp;    public void setIsConnectionError(boolean isConnectionError){
<b class="nc"><i>258</i>&nbsp;        this.isConnectionError = isConnectionError;</b>
<i>259</i>&nbsp;    }
<i>260</i>&nbsp;
<i>261</i>&nbsp;    //-----------------------------------------END SETTER----------------------------------------------
<i>262</i>&nbsp;
<i>263</i>&nbsp;    //-----------------------------------------SYNCHRONIZATION METHODS---------------------------------
<i>264</i>&nbsp;
<i>265</i>&nbsp;    /**
<i>266</i>&nbsp;     * This method notifies closeWindow when user closes setting window. It also closes setting window and the client
<i>267</i>&nbsp;     */
<i>268</i>&nbsp;    public synchronized void setCloseWindow(){
<b class="nc"><i>269</i>&nbsp;        closeWindow.set(true);</b>
<b class="nc"><i>270</i>&nbsp;        valid.set(true); //true --&gt; in order to exit to cycles that are waiting for responses</b>
<b class="nc"><i>271</i>&nbsp;        setPort(0); //set port because if user quits after disconnection, last port is saved and returns creating errors</b>
<b class="nc"><i>272</i>&nbsp;        settingStage.close();</b>
<i>273</i>&nbsp;        try {
<b class="nc"><i>274</i>&nbsp;            client.end();</b>
<b class="nc"><i>275</i>&nbsp;        } catch (ChannelClosedException ex) {</b>
<b class="nc"><i>276</i>&nbsp;            ex.printStackTrace();</b>
<b class="nc"><i>277</i>&nbsp;            System.err.println(&quot;Connection Lost&quot;);</b>
<b class="nc"><i>278</i>&nbsp;        }</b>
<b class="nc"><i>279</i>&nbsp;        notifyAll();</b>
<i>280</i>&nbsp;    }
<i>281</i>&nbsp;
<i>282</i>&nbsp;    /**
<i>283</i>&nbsp;     * This method notifies clicked when user clicks on connect in the setting window
<i>284</i>&nbsp;     */
<i>285</i>&nbsp;    private synchronized void setClicked(){
<b class="nc"><i>286</i>&nbsp;        clicked.set(true);</b>
<b class="nc"><i>287</i>&nbsp;        notifyAll();</b>
<i>288</i>&nbsp;    }
<i>289</i>&nbsp;
<i>290</i>&nbsp;    /**
<i>291</i>&nbsp;     * This method notifies restartConnection when user clicks on disconnect in the setting window. It also restarts the client
<i>292</i>&nbsp;     */
<i>293</i>&nbsp;    private synchronized void restartConnection(){
<b class="nc"><i>294</i>&nbsp;        restartConnection.set(true);</b>
<b class="nc"><i>295</i>&nbsp;        notifyAll();</b>
<b class="nc"><i>296</i>&nbsp;        restartClient();</b>
<i>297</i>&nbsp;    }
<i>298</i>&nbsp;
<i>299</i>&nbsp;    /**
<i>300</i>&nbsp;     * This method notifies openGame when user clicks on play in the setting window
<i>301</i>&nbsp;     */
<i>302</i>&nbsp;    private synchronized void setOpenGame(){
<b class="nc"><i>303</i>&nbsp;        openGame.set(true);</b>
<b class="nc"><i>304</i>&nbsp;        notifyAll();</b>
<i>305</i>&nbsp;    }
<i>306</i>&nbsp;
<i>307</i>&nbsp;    /**
<i>308</i>&nbsp;     * This method notifies gameIsReady when menu scene is ready and displayed. Server is asking for username and this variable waits for menu scene to be ready to ask the username
<i>309</i>&nbsp;     */
<i>310</i>&nbsp;    private synchronized void setGameIsReady(){
<b class="nc"><i>311</i>&nbsp;        gameIsReady.set(true);</b>
<b class="nc"><i>312</i>&nbsp;        notifyAll();</b>
<i>313</i>&nbsp;    }
<i>314</i>&nbsp;
<i>315</i>&nbsp;    /**
<i>316</i>&nbsp;     * This method notifies readyForTheMatch when match scene is ready and displayed. Server will ask cards to challenger and this variable waits for match scene to be ready to ask cards to challenger
<i>317</i>&nbsp;     */
<i>318</i>&nbsp;    private synchronized void setReadyForTheMatch(){
<b class="nc"><i>319</i>&nbsp;        readyForTheMatch.set(true);</b>
<b class="nc"><i>320</i>&nbsp;        notifyAll();</b>
<i>321</i>&nbsp;    }
<i>322</i>&nbsp;
<i>323</i>&nbsp;    /**
<i>324</i>&nbsp;     * This method notifies inMenuPage when menu page is opened or not
<i>325</i>&nbsp;     * @param inMenuPage Boolean that is true if menu page is opened
<i>326</i>&nbsp;     */
<i>327</i>&nbsp;    private synchronized void setInMenuPage(boolean inMenuPage){
<b class="nc"><i>328</i>&nbsp;        this.inMenuPage = inMenuPage;</b>
<b class="nc"><i>329</i>&nbsp;        notifyAll();</b>
<i>330</i>&nbsp;    }
<i>331</i>&nbsp;
<i>332</i>&nbsp;    //-----------------------------------------END SYNCHRONIZATION METHODS-----------------------------
<i>333</i>&nbsp;
<i>334</i>&nbsp;    /**
<i>335</i>&nbsp;     * This method creates setting stage, that is the first stage shown in gui
<i>336</i>&nbsp;     * @param settingsStage Stage to show
<i>337</i>&nbsp;     */
<i>338</i>&nbsp;    private void createSettingStage(Stage settingsStage){
<i>339</i>&nbsp;        //initialization --&gt; I need it if we restart the setting page after a connection lost
<b class="nc"><i>340</i>&nbsp;        screenWidth = Screen.getPrimary().getBounds().getWidth();</b>
<b class="nc"><i>341</i>&nbsp;        screenHeight = Screen.getPrimary().getBounds().getHeight();</b>
<b class="nc"><i>342</i>&nbsp;        gameIsReady = new AtomicBoolean(false);</b>
<b class="nc"><i>343</i>&nbsp;        readyForTheMatch = new AtomicBoolean(false);</b>
<b class="nc"><i>344</i>&nbsp;        clicked = new AtomicBoolean(false);</b>
<b class="nc"><i>345</i>&nbsp;        openGame = new AtomicBoolean(false);</b>
<b class="nc"><i>346</i>&nbsp;        restartConnection = new AtomicBoolean(false);</b>
<b class="nc"><i>347</i>&nbsp;        closeWindow = new AtomicBoolean(false);</b>
<b class="nc"><i>348</i>&nbsp;        valid = new AtomicBoolean(false);</b>
<b class="nc"><i>349</i>&nbsp;        secondWindow = false;</b>
<i>350</i>&nbsp;
<b class="nc"><i>351</i>&nbsp;        this.settingStage = settingsStage;</b>
<b class="nc"><i>352</i>&nbsp;        StackPane settings = new StackPane();</b>
<b class="nc"><i>353</i>&nbsp;        setInMenuPage(false);</b>
<b class="nc"><i>354</i>&nbsp;        createSettingsPane(settings);</b>
<i>355</i>&nbsp;
<b class="nc"><i>356</i>&nbsp;        Scene settingsScene = new Scene(settings);</b>
<i>357</i>&nbsp;
<b class="nc"><i>358</i>&nbsp;        settingsStage.setScene(settingsScene);</b>
<b class="nc"><i>359</i>&nbsp;        settingsStage.setWidth(screenWidth/2);</b>
<b class="nc"><i>360</i>&nbsp;        settingsStage.setHeight(screenHeight/2);</b>
<i>361</i>&nbsp;
<b class="nc"><i>362</i>&nbsp;        if(!isConnectionError)</b>
<b class="nc"><i>363</i>&nbsp;            client.start();</b>
<i>364</i>&nbsp;
<b class="nc"><i>365</i>&nbsp;        setIsConnectionError(false);</b>
<b class="nc"><i>366</i>&nbsp;        settingsStage.setResizable(false);</b>
<b class="nc"><i>367</i>&nbsp;        settingsStage.initStyle(StageStyle.UNDECORATED);</b>
<b class="nc"><i>368</i>&nbsp;        settingsStage.setX((screenWidth - settingsStage.getWidth()) / 2);</b>
<b class="nc"><i>369</i>&nbsp;        settingsStage.setY((screenHeight - settingsStage.getHeight()) / 2);</b>
<i>370</i>&nbsp;
<b class="nc"><i>371</i>&nbsp;        settingsStage.getIcons().add(new Image(Gui.class.getResourceAsStream(&quot;/img/icon.png&quot;)));</b>
<b class="nc"><i>372</i>&nbsp;        settingsStage.show();</b>
<i>373</i>&nbsp;    }
<i>374</i>&nbsp;
<i>375</i>&nbsp;    /**
<i>376</i>&nbsp;     * This method creates primary scene of the game (after setting window)
<i>377</i>&nbsp;     */
<i>378</i>&nbsp;    public void primaryScene(){
<b class="nc"><i>379</i>&nbsp;        if(window==null) {</b>
<b class="nc"><i>380</i>&nbsp;            mainScene = new StackPane();</b>
<b class="nc"><i>381</i>&nbsp;            createTransitionClouds();</b>
<b class="nc"><i>382</i>&nbsp;            closePopup();</b>
<b class="nc"><i>383</i>&nbsp;            createConnectionErrorPane();</b>
<b class="nc"><i>384</i>&nbsp;            window = new Stage();</b>
<b class="nc"><i>385</i>&nbsp;            if (screenWidth == Screen.getPrimary().getBounds().getWidth() &amp;&amp; screenHeight == Screen.getPrimary().getBounds().getHeight()) {</b>
<b class="nc"><i>386</i>&nbsp;                window.setMaximized(true);</b>
<i>387</i>&nbsp;            } else {
<b class="nc"><i>388</i>&nbsp;                window.setWidth(screenWidth);</b>
<b class="nc"><i>389</i>&nbsp;                window.setHeight(screenHeight);</b>
<b class="nc"><i>390</i>&nbsp;                window.setX((Screen.getPrimary().getBounds().getWidth() - window.getWidth()) / 2);</b>
<b class="nc"><i>391</i>&nbsp;                window.setY((Screen.getPrimary().getBounds().getHeight() - window.getHeight()) / 2);</b>
<i>392</i>&nbsp;
<i>393</i>&nbsp;            }
<b class="nc"><i>394</i>&nbsp;            window.initStyle(StageStyle.UNDECORATED);</b>
<b class="nc"><i>395</i>&nbsp;            window.setTitle(&quot;Santorini&quot;);</b>
<b class="nc"><i>396</i>&nbsp;            window.setOnCloseRequest(e -&gt; {</b>
<b class="nc"><i>397</i>&nbsp;                e.consume();</b>
<b class="nc"><i>398</i>&nbsp;                closeProgram();</b>
<i>399</i>&nbsp;            });
<b class="nc"><i>400</i>&nbsp;            window.setResizable(false);</b>
<b class="nc"><i>401</i>&nbsp;            window.getIcons().add(new Image(Gui.class.getResourceAsStream(&quot;/img/icon.png&quot;)));</b>
<b class="nc"><i>402</i>&nbsp;            menuPage = new HBox();</b>
<b class="nc"><i>403</i>&nbsp;            matchPage = new StackPane();</b>
<b class="nc"><i>404</i>&nbsp;            mainScene.getChildren().addAll(openingPage, menuPage, loadingPage, matchPage, transitionClouds, howToPlayBox, closePopup, connectionError);</b>
<i>405</i>&nbsp;        } else {
<b class="nc"><i>406</i>&nbsp;            mainScene.getChildren().removeAll(menuPage, matchPage);</b>
<b class="nc"><i>407</i>&nbsp;            menuPage = new HBox();</b>
<b class="nc"><i>408</i>&nbsp;            matchPage = new StackPane();</b>
<b class="nc"><i>409</i>&nbsp;            mainScene.getChildren().add(1, menuPage);</b>
<b class="nc"><i>410</i>&nbsp;            mainScene.getChildren().add(3, matchPage);</b>
<i>411</i>&nbsp;        }
<i>412</i>&nbsp;
<b class="nc"><i>413</i>&nbsp;        if(screenWidth != Screen.getPrimary().getBounds().getWidth() &amp;&amp; screenHeight != Screen.getPrimary().getBounds().getHeight()) {</b>
<b class="nc"><i>414</i>&nbsp;            mainScene.setOnMousePressed(e -&gt; {</b>
<b class="nc"><i>415</i>&nbsp;                xOffset = window.getX() - e.getScreenX();</b>
<b class="nc"><i>416</i>&nbsp;                yOffset = window.getY() - e.getScreenY();</b>
<i>417</i>&nbsp;            });
<b class="nc"><i>418</i>&nbsp;            mainScene.setOnMouseDragged(e -&gt; {</b>
<b class="nc"><i>419</i>&nbsp;                window.setX(e.getScreenX() + xOffset);</b>
<b class="nc"><i>420</i>&nbsp;                window.setY(e.getScreenY() + yOffset);</b>
<i>421</i>&nbsp;            });
<i>422</i>&nbsp;        }
<i>423</i>&nbsp;
<b class="nc"><i>424</i>&nbsp;        openingPage.setVisible(!secondMatch);</b>
<b class="nc"><i>425</i>&nbsp;        menuPage.setVisible(secondMatch);</b>
<i>426</i>&nbsp;
<b class="nc"><i>427</i>&nbsp;        if(!secondMatch) {</b>
<b class="nc"><i>428</i>&nbsp;            openingPage();</b>
<b class="nc"><i>429</i>&nbsp;            transitionClouds.setVisible(false);</b>
<i>430</i>&nbsp;        } else {
<b class="nc"><i>431</i>&nbsp;            menuScene = null;</b>
<b class="nc"><i>432</i>&nbsp;            menuScene = new MenuScene(this, menuPage, screenWidth, screenHeight, loadingPage, howToPlayBox);</b>
<b class="nc"><i>433</i>&nbsp;            menuScene.setMenuScene();</b>
<b class="nc"><i>434</i>&nbsp;            restartClient();</b>
<b class="nc"><i>435</i>&nbsp;            setInMenuPage(true);</b>
<i>436</i>&nbsp;
<i>437</i>&nbsp;        }
<b class="nc"><i>438</i>&nbsp;        loadingPage.setVisible(false);</b>
<b class="nc"><i>439</i>&nbsp;        closePopup.setVisible(false);</b>
<b class="nc"><i>440</i>&nbsp;        closePopup.setAlignment(Pos.CENTER);</b>
<b class="nc"><i>441</i>&nbsp;        matchPage.setVisible(false);</b>
<b class="nc"><i>442</i>&nbsp;        howToPlayBox.setVisible(false);</b>
<b class="nc"><i>443</i>&nbsp;        connectionError.setVisible(isConnectionError);</b>
<i>444</i>&nbsp;
<b class="nc"><i>445</i>&nbsp;        matchScene = new MatchScene(this, screenWidth, screenHeight, matchPage);</b>
<i>446</i>&nbsp;
<b class="nc"><i>447</i>&nbsp;        if(!secondMatch)</b>
<b class="nc"><i>448</i>&nbsp;            fullScene = new Scene(mainScene);</b>
<b class="nc"><i>449</i>&nbsp;        window.setScene(fullScene);</b>
<b class="nc"><i>450</i>&nbsp;        secondWindow = true;</b>
<b class="nc"><i>451</i>&nbsp;        window.show();</b>
<i>452</i>&nbsp;    }
<i>453</i>&nbsp;
<i>454</i>&nbsp;
<i>455</i>&nbsp;
<i>456</i>&nbsp;    //------------------------------------------SETTINGS PAGE----------------------------------------------------------
<i>457</i>&nbsp;
<i>458</i>&nbsp;    /**
<i>459</i>&nbsp;     * This method creates initial setting page
<i>460</i>&nbsp;     * @param settings Setting window
<i>461</i>&nbsp;     */
<i>462</i>&nbsp;    private void createSettingsPane(StackPane settings){
<i>463</i>&nbsp;
<i>464</i>&nbsp;        //title bar
<i>465</i>&nbsp;
<b class="nc"><i>466</i>&nbsp;        HBox titleBar = new HBox();</b>
<b class="nc"><i>467</i>&nbsp;        titleBar.setMaxHeight(screenHeight/30);</b>
<b class="nc"><i>468</i>&nbsp;        titleBar.setPrefWidth(screenWidth/2);</b>
<b class="nc"><i>469</i>&nbsp;        titleBar.setStyle(&quot;-fx-background-color: rgba(160, 146, 134, 0.5)&quot;);</b>
<i>470</i>&nbsp;
<i>471</i>&nbsp;
<b class="nc"><i>472</i>&nbsp;        Image iconImg = new Image(MenuScene.class.getResource(&quot;/img/icon.png&quot;).toString(), screenWidth/35, screenHeight/30, false, false);</b>
<b class="nc"><i>473</i>&nbsp;        ImageView iconView = new ImageView(iconImg);</b>
<b class="nc"><i>474</i>&nbsp;        Label icon = new Label();</b>
<b class="nc"><i>475</i>&nbsp;        icon.setGraphic(iconView);</b>
<b class="nc"><i>476</i>&nbsp;        icon.setTextAlignment(TextAlignment.CENTER);</b>
<b class="nc"><i>477</i>&nbsp;        icon.setAlignment(Pos.TOP_LEFT);</b>
<b class="nc"><i>478</i>&nbsp;        icon.setPadding(new Insets(screenHeight/200));</b>
<i>479</i>&nbsp;
<b class="nc"><i>480</i>&nbsp;        Label exit = new Label(&quot;X&quot;);</b>
<b class="nc"><i>481</i>&nbsp;        exit.setFont(lillybelleFont);</b>
<b class="nc"><i>482</i>&nbsp;        exit.setTextAlignment(TextAlignment.RIGHT);</b>
<b class="nc"><i>483</i>&nbsp;        exit.setAlignment(Pos.TOP_RIGHT);</b>
<i>484</i>&nbsp;
<b class="nc"><i>485</i>&nbsp;        exit.setOnMouseEntered(e -&gt;{</b>
<b class="nc"><i>486</i>&nbsp;            exit.setTextFill(GREY);</b>
<b class="nc"><i>487</i>&nbsp;            exit.setCursor(Cursor.HAND);</b>
<i>488</i>&nbsp;        });
<b class="nc"><i>489</i>&nbsp;        exit.setOnMouseExited(e -&gt;{</b>
<b class="nc"><i>490</i>&nbsp;            exit.setTextFill(BLACK);</b>
<b class="nc"><i>491</i>&nbsp;            exit.setCursor(Cursor.DEFAULT);</b>
<i>492</i>&nbsp;        });
<b class="nc"><i>493</i>&nbsp;        exit.setOnMouseClicked(e -&gt; {</b>
<b class="nc"><i>494</i>&nbsp;            setCloseWindow();</b>
<i>495</i>&nbsp;        });
<i>496</i>&nbsp;
<b class="nc"><i>497</i>&nbsp;        Label minimize = new Label(&quot;-&quot;);</b>
<b class="nc"><i>498</i>&nbsp;        minimize.setFont(Font.font(&quot;Arial&quot;, screenWidth/50));</b>
<b class="nc"><i>499</i>&nbsp;        minimize.setTextAlignment(TextAlignment.RIGHT);</b>
<b class="nc"><i>500</i>&nbsp;        minimize.setAlignment(Pos.TOP_RIGHT);</b>
<i>501</i>&nbsp;
<b class="nc"><i>502</i>&nbsp;        minimize.setOnMouseEntered(e -&gt;{</b>
<b class="nc"><i>503</i>&nbsp;            minimize.setTextFill(GREY);</b>
<b class="nc"><i>504</i>&nbsp;            minimize.setCursor(Cursor.HAND);</b>
<i>505</i>&nbsp;        });
<b class="nc"><i>506</i>&nbsp;        minimize.setOnMouseExited(e -&gt;{</b>
<b class="nc"><i>507</i>&nbsp;            minimize.setTextFill(BLACK);</b>
<b class="nc"><i>508</i>&nbsp;            minimize.setCursor(Cursor.DEFAULT);</b>
<i>509</i>&nbsp;        });
<b class="nc"><i>510</i>&nbsp;        minimize.setOnMouseClicked(e -&gt; {</b>
<b class="nc"><i>511</i>&nbsp;            settingStage.setIconified(true);</b>
<i>512</i>&nbsp;        });
<i>513</i>&nbsp;
<b class="nc"><i>514</i>&nbsp;        HBox titleActions = new HBox();</b>
<b class="nc"><i>515</i>&nbsp;        titleActions.setSpacing(screenWidth/100);</b>
<b class="nc"><i>516</i>&nbsp;        titleActions.getChildren().addAll(minimize, exit);</b>
<i>517</i>&nbsp;
<b class="nc"><i>518</i>&nbsp;        titleBar.getChildren().addAll(icon, titleActions);</b>
<b class="nc"><i>519</i>&nbsp;        titleBar.setSpacing((screenWidth/2)-screenWidth/15);</b>
<i>520</i>&nbsp;
<i>521</i>&nbsp;        //end title bar
<i>522</i>&nbsp;
<b class="nc"><i>523</i>&nbsp;        Image settingsBackground = new Image(MenuScene.class.getResource(&quot;/img/settingsPage/background.png&quot;).toString(), screenWidth/2, screenHeight/2, false, false);</b>
<b class="nc"><i>524</i>&nbsp;        ImageView settingsBackgroundView = new ImageView(settingsBackground);</b>
<i>525</i>&nbsp;
<b class="nc"><i>526</i>&nbsp;        HBox settingsPage = new HBox();</b>
<i>527</i>&nbsp;
<b class="nc"><i>528</i>&nbsp;        VBox connectionSettings = new VBox();</b>
<b class="nc"><i>529</i>&nbsp;        connectionSettings.setSpacing(screenHeight/50);</b>
<b class="nc"><i>530</i>&nbsp;        connectionSettings.setPrefWidth(screenWidth/4);</b>
<b class="nc"><i>531</i>&nbsp;        connectionSettings.setPrefHeight(screenHeight/2);</b>
<b class="nc"><i>532</i>&nbsp;        connectionSettings.setPadding(new Insets(screenHeight/20, 0, 0, 0));</b>
<i>533</i>&nbsp;
<b class="nc"><i>534</i>&nbsp;        ipForm.setFont(lillybelleFont);</b>
<b class="nc"><i>535</i>&nbsp;        ipForm.setTextAlignment(TextAlignment.CENTER);</b>
<b class="nc"><i>536</i>&nbsp;        ipFormField = new TextField();</b>
<b class="nc"><i>537</i>&nbsp;        ipFormField.setFont(settingsFont);</b>
<b class="nc"><i>538</i>&nbsp;        ipFormField.setMaxWidth(screenWidth/10);</b>
<i>539</i>&nbsp;
<b class="nc"><i>540</i>&nbsp;        portForm.setFont(lillybelleFont);</b>
<b class="nc"><i>541</i>&nbsp;        portForm.setTextAlignment(TextAlignment.CENTER);</b>
<b class="nc"><i>542</i>&nbsp;        portFormField = new TextField();</b>
<b class="nc"><i>543</i>&nbsp;        portFormField.setFont(settingsFont);</b>
<b class="nc"><i>544</i>&nbsp;        portFormField.setMaxWidth(screenWidth/10);</b>
<i>545</i>&nbsp;
<b class="nc"><i>546</i>&nbsp;        connectionButton.setFont(lillybelleFont);</b>
<b class="nc"><i>547</i>&nbsp;        connectionButton.setOnMouseEntered(e -&gt; {</b>
<b class="nc"><i>548</i>&nbsp;            connectionButton.setCursor(Cursor.HAND);</b>
<i>549</i>&nbsp;        });
<b class="nc"><i>550</i>&nbsp;        connectionButton.setOnMouseExited(e -&gt; {</b>
<b class="nc"><i>551</i>&nbsp;            connectionButton.setCursor(Cursor.DEFAULT);</b>
<i>552</i>&nbsp;        });
<i>553</i>&nbsp;
<b class="nc"><i>554</i>&nbsp;        Image loadingImg = new Image(MenuScene.class.getResource(&quot;/img/loadingAndPopups/loadingIcon.gif&quot;).toString(), screenWidth / 30, screenHeight / 25, false, false);</b>
<b class="nc"><i>555</i>&nbsp;        loadingIcon = new ImageView(loadingImg);</b>
<i>556</i>&nbsp;
<b class="nc"><i>557</i>&nbsp;        errorMessage = new Text();</b>
<b class="nc"><i>558</i>&nbsp;        errorMessage.setFont(settingsFont);</b>
<b class="nc"><i>559</i>&nbsp;        errorMessage.setFill(Color.DARKRED);</b>
<b class="nc"><i>560</i>&nbsp;        errorMessage.setTextAlignment(TextAlignment.CENTER);</b>
<i>561</i>&nbsp;
<b class="nc"><i>562</i>&nbsp;        connectedText = new Text(&quot;Connected&quot;);</b>
<b class="nc"><i>563</i>&nbsp;        connectedText.setFont(lillybelleFont);</b>
<b class="nc"><i>564</i>&nbsp;        connectedText.setFill(DARKGREEN);</b>
<b class="nc"><i>565</i>&nbsp;        disconnectionButton = new Button(&quot;Disconnect&quot;);</b>
<b class="nc"><i>566</i>&nbsp;        disconnectionButton.setFont(lillybelleFont);</b>
<i>567</i>&nbsp;
<b class="nc"><i>568</i>&nbsp;        connectionSettings.getChildren().addAll(ipForm, ipFormField, portForm, portFormField, connectionButton, loadingIcon, errorMessage, connectedText, disconnectionButton);</b>
<b class="nc"><i>569</i>&nbsp;        loadingIcon.setVisible(false);</b>
<b class="nc"><i>570</i>&nbsp;        loadingIcon.setManaged(false);</b>
<b class="nc"><i>571</i>&nbsp;        errorMessage.setVisible(false);</b>
<b class="nc"><i>572</i>&nbsp;        errorMessage.setManaged(false);</b>
<b class="nc"><i>573</i>&nbsp;        connectedText.setVisible(false);</b>
<b class="nc"><i>574</i>&nbsp;        connectedText.setManaged(false);</b>
<b class="nc"><i>575</i>&nbsp;        disconnectionButton.setVisible(false);</b>
<b class="nc"><i>576</i>&nbsp;        disconnectionButton.setManaged(false);</b>
<i>577</i>&nbsp;
<b class="nc"><i>578</i>&nbsp;        Text screenSizeText = new Text(&quot;Choose window dimension&quot;);</b>
<b class="nc"><i>579</i>&nbsp;        screenSizeText.setFont(lillybelleFont);</b>
<b class="nc"><i>580</i>&nbsp;        screenSizeText.setTextAlignment(TextAlignment.CENTER);</b>
<b class="nc"><i>581</i>&nbsp;        screenSizeText.setWrappingWidth(screenWidth/5);</b>
<i>582</i>&nbsp;
<b class="nc"><i>583</i>&nbsp;        screenSizeOptions = new ComboBox(FXCollections.observableArrayList(</b>
<i>584</i>&nbsp;                &quot;Full Screen&quot;, &quot;1920 x 1080&quot;, &quot;1680 x 1050&quot;, &quot;1600 x 900&quot;, &quot;1440 x 900&quot;, &quot;1366 x 768&quot;, &quot;1360 x 768&quot;, &quot;1280 x 800&quot;, &quot;1280 x 768&quot;, &quot;1280 x 720&quot;)
<i>585</i>&nbsp;        );
<b class="nc"><i>586</i>&nbsp;        screenSizeOptions.getEditor().setAlignment(Pos.CENTER);</b>
<b class="nc"><i>587</i>&nbsp;        screenSizeOptions.getSelectionModel().selectFirst();</b>
<b class="nc"><i>588</i>&nbsp;        screenSizeOptions.setOnAction(e -&gt; {</b>
<b class="nc"><i>589</i>&nbsp;            windowSize(screenSizeOptions.getSelectionModel().getSelectedIndex());</b>
<i>590</i>&nbsp;        });
<i>591</i>&nbsp;
<b class="nc"><i>592</i>&nbsp;        screenSizeError = new Text();</b>
<b class="nc"><i>593</i>&nbsp;        screenSizeError.setFont(settingsFont);</b>
<b class="nc"><i>594</i>&nbsp;        screenSizeError.setFill(DARKRED);</b>
<b class="nc"><i>595</i>&nbsp;        screenSizeError.setTextAlignment(TextAlignment.CENTER);</b>
<b class="nc"><i>596</i>&nbsp;        screenSizeError.setWrappingWidth(screenWidth/4);</b>
<b class="nc"><i>597</i>&nbsp;        screenSizeError.setVisible(false);</b>
<b class="nc"><i>598</i>&nbsp;        screenSizeError.setManaged(true);</b>
<i>599</i>&nbsp;
<b class="nc"><i>600</i>&nbsp;        VBox screenSize = new VBox();</b>
<b class="nc"><i>601</i>&nbsp;        screenSize.getChildren().addAll(screenSizeText, screenSizeOptions, screenSizeError);</b>
<b class="nc"><i>602</i>&nbsp;        screenSize.setSpacing(screenHeight/50);</b>
<b class="nc"><i>603</i>&nbsp;        screenSize.setPrefHeight(screenHeight/4);</b>
<b class="nc"><i>604</i>&nbsp;        screenSize.setAlignment(Pos.CENTER);</b>
<i>605</i>&nbsp;
<b class="nc"><i>606</i>&nbsp;        enterGameButton = new Button(&quot;Play&quot;);</b>
<b class="nc"><i>607</i>&nbsp;        enterGameButton.setFont(lillybelleFont);</b>
<b class="nc"><i>608</i>&nbsp;        enterGameButton.setTextFill(WHITE);</b>
<b class="nc"><i>609</i>&nbsp;        enterGameButton.setBackground(new Background(new BackgroundFill(DARKGREEN, CornerRadii.EMPTY, Insets.EMPTY)));</b>
<b class="nc"><i>610</i>&nbsp;        enterGameButton.setEffect(new DropShadow(10, Color.BLACK));</b>
<b class="nc"><i>611</i>&nbsp;        enterGameButton.setOnMouseEntered(e -&gt; {</b>
<b class="nc"><i>612</i>&nbsp;            enterGameButton.setEffect(new DropShadow(30, Color.BLACK));</b>
<b class="nc"><i>613</i>&nbsp;            enterGameButton.setCursor(Cursor.HAND);</b>
<i>614</i>&nbsp;        });
<b class="nc"><i>615</i>&nbsp;        enterGameButton.setOnMouseExited(e -&gt; {</b>
<b class="nc"><i>616</i>&nbsp;            enterGameButton.setEffect(new DropShadow(10, Color.BLACK));</b>
<b class="nc"><i>617</i>&nbsp;            enterGameButton.setCursor(Cursor.DEFAULT);</b>
<i>618</i>&nbsp;        });
<i>619</i>&nbsp;
<i>620</i>&nbsp;
<b class="nc"><i>621</i>&nbsp;        VBox windowDimensionSettings = new VBox();</b>
<b class="nc"><i>622</i>&nbsp;        windowDimensionSettings.setPrefWidth(screenWidth/4);</b>
<b class="nc"><i>623</i>&nbsp;        windowDimensionSettings.setPrefHeight(screenHeight/2);</b>
<i>624</i>&nbsp;
<b class="nc"><i>625</i>&nbsp;        windowDimensionSettings.getChildren().addAll(screenSize, enterGameButton);</b>
<b class="nc"><i>626</i>&nbsp;        enterGameButton.setVisible(false);</b>
<b class="nc"><i>627</i>&nbsp;        enterGameButton.setManaged(true);</b>
<i>628</i>&nbsp;
<b class="nc"><i>629</i>&nbsp;        settingsPage.getChildren().addAll(connectionSettings, windowDimensionSettings);</b>
<b class="nc"><i>630</i>&nbsp;        connectionSettings.setAlignment(Pos.CENTER);</b>
<b class="nc"><i>631</i>&nbsp;        windowDimensionSettings.setAlignment(Pos.CENTER);</b>
<b class="nc"><i>632</i>&nbsp;        settingsPage.setAlignment(Pos.CENTER);</b>
<b class="nc"><i>633</i>&nbsp;        settingsPage.setPrefWidth(screenWidth/2);</b>
<b class="nc"><i>634</i>&nbsp;        settingsPage.setPrefHeight(screenHeight/2);</b>
<i>635</i>&nbsp;
<b class="nc"><i>636</i>&nbsp;        settings.getChildren().addAll(settingsBackgroundView, settingsPage, titleBar);</b>
<b class="nc"><i>637</i>&nbsp;        StackPane.setAlignment(titleBar, Pos.TOP_CENTER);</b>
<i>638</i>&nbsp;
<i>639</i>&nbsp;        //undecorated but movable
<b class="nc"><i>640</i>&nbsp;        settings.setOnMousePressed(e -&gt; {</b>
<b class="nc"><i>641</i>&nbsp;            xOffset = settingStage.getX() - e.getScreenX();</b>
<b class="nc"><i>642</i>&nbsp;            yOffset = settingStage.getY() - e.getScreenY();</b>
<i>643</i>&nbsp;        });
<b class="nc"><i>644</i>&nbsp;        settings.setOnMouseDragged(e -&gt; {</b>
<b class="nc"><i>645</i>&nbsp;            settingStage.setX(e.getScreenX() + xOffset);</b>
<b class="nc"><i>646</i>&nbsp;            settingStage.setY(e.getScreenY() + yOffset);</b>
<i>647</i>&nbsp;        });
<i>648</i>&nbsp;
<i>649</i>&nbsp;    }
<i>650</i>&nbsp;
<i>651</i>&nbsp;    //------------------------------------------END SETTINGS PAGE------------------------------------------------------
<i>652</i>&nbsp;
<i>653</i>&nbsp;    /**
<i>654</i>&nbsp;     * This method sets primary scene size based on size choice in the setting window
<i>655</i>&nbsp;     * @param sizeChoice Index of size choice in the list of options
<i>656</i>&nbsp;     */
<i>657</i>&nbsp;    private void windowSize(int sizeChoice){
<b class="nc"><i>658</i>&nbsp;        switch (sizeChoice){</b>
<i>659</i>&nbsp;            case 0:
<b class="nc"><i>660</i>&nbsp;                this.screenWidth = Screen.getPrimary().getBounds().getWidth();</b>
<b class="nc"><i>661</i>&nbsp;                this.screenHeight = Screen.getPrimary().getBounds().getHeight();</b>
<b class="nc"><i>662</i>&nbsp;                break;</b>
<i>663</i>&nbsp;            case 1:
<b class="nc"><i>664</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1920 || Screen.getPrimary().getBounds().getHeight()&lt;1080){</b>
<b class="nc"><i>665</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1920 x 1080 resolution&quot;);</b>
<b class="nc"><i>666</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>667</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>668</i>&nbsp;                } else {
<b class="nc"><i>669</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>670</i>&nbsp;                    this.screenWidth = 1920;</b>
<b class="nc"><i>671</i>&nbsp;                    this.screenHeight = 1080;</b>
<i>672</i>&nbsp;                }
<b class="nc"><i>673</i>&nbsp;                break;</b>
<i>674</i>&nbsp;            case 2:
<b class="nc"><i>675</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1680 || Screen.getPrimary().getBounds().getHeight()&lt;1050){</b>
<b class="nc"><i>676</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1680 x 1050 resolution&quot;);</b>
<b class="nc"><i>677</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>678</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>679</i>&nbsp;                } else {
<b class="nc"><i>680</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>681</i>&nbsp;                    this.screenWidth = 1680;</b>
<b class="nc"><i>682</i>&nbsp;                    this.screenHeight = 1050;</b>
<i>683</i>&nbsp;                }
<b class="nc"><i>684</i>&nbsp;                break;</b>
<i>685</i>&nbsp;            case 3:
<b class="nc"><i>686</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1600 || Screen.getPrimary().getBounds().getHeight()&lt;900){</b>
<b class="nc"><i>687</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1600 x 900 resolution&quot;);</b>
<b class="nc"><i>688</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>689</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>690</i>&nbsp;                } else {
<b class="nc"><i>691</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>692</i>&nbsp;                    this.screenWidth = 1600;</b>
<b class="nc"><i>693</i>&nbsp;                    this.screenHeight = 900;</b>
<i>694</i>&nbsp;                }
<b class="nc"><i>695</i>&nbsp;                break;</b>
<i>696</i>&nbsp;            case 4:
<b class="nc"><i>697</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1440 || Screen.getPrimary().getBounds().getHeight()&lt;900){</b>
<b class="nc"><i>698</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1440 x 900 resolution&quot;);</b>
<b class="nc"><i>699</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>700</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>701</i>&nbsp;                } else {
<b class="nc"><i>702</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>703</i>&nbsp;                    this.screenWidth = 1440;</b>
<b class="nc"><i>704</i>&nbsp;                    this.screenHeight = 900;</b>
<i>705</i>&nbsp;                }
<b class="nc"><i>706</i>&nbsp;                break;</b>
<i>707</i>&nbsp;            case 5:
<b class="nc"><i>708</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1366 || Screen.getPrimary().getBounds().getHeight()&lt;768){</b>
<b class="nc"><i>709</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1366 x 768 resolution&quot;);</b>
<b class="nc"><i>710</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>711</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>712</i>&nbsp;                } else {
<b class="nc"><i>713</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>714</i>&nbsp;                    this.screenWidth = 1366;</b>
<b class="nc"><i>715</i>&nbsp;                    this.screenHeight = 768;</b>
<i>716</i>&nbsp;                }
<b class="nc"><i>717</i>&nbsp;                break;</b>
<i>718</i>&nbsp;            case 6:
<b class="nc"><i>719</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1360 || Screen.getPrimary().getBounds().getHeight()&lt;768){</b>
<b class="nc"><i>720</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1360 x 768 resolution&quot;);</b>
<b class="nc"><i>721</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>722</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>723</i>&nbsp;                } else {
<b class="nc"><i>724</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>725</i>&nbsp;                    this.screenWidth = 1360;</b>
<b class="nc"><i>726</i>&nbsp;                    this.screenHeight = 768;</b>
<i>727</i>&nbsp;                }
<b class="nc"><i>728</i>&nbsp;                break;</b>
<i>729</i>&nbsp;            case 7:
<b class="nc"><i>730</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1280 || Screen.getPrimary().getBounds().getHeight()&lt;800){</b>
<b class="nc"><i>731</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1280 x 800 resolution&quot;);</b>
<b class="nc"><i>732</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>733</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>734</i>&nbsp;                } else {
<b class="nc"><i>735</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>736</i>&nbsp;                    this.screenWidth = 1280;</b>
<b class="nc"><i>737</i>&nbsp;                    this.screenHeight = 800;</b>
<i>738</i>&nbsp;                }
<b class="nc"><i>739</i>&nbsp;                break;</b>
<i>740</i>&nbsp;            case 8:
<b class="nc"><i>741</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1280 || Screen.getPrimary().getBounds().getHeight()&lt;768){</b>
<b class="nc"><i>742</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1280 x 768 resolution&quot;);</b>
<b class="nc"><i>743</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>744</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>745</i>&nbsp;                } else {
<b class="nc"><i>746</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>747</i>&nbsp;                    this.screenWidth = 1280;</b>
<b class="nc"><i>748</i>&nbsp;                    this.screenHeight = 768;</b>
<i>749</i>&nbsp;                }
<b class="nc"><i>750</i>&nbsp;                break;</b>
<i>751</i>&nbsp;            case 9:
<b class="nc"><i>752</i>&nbsp;                if(Screen.getPrimary().getBounds().getWidth()&lt;1280 || Screen.getPrimary().getBounds().getHeight()&lt;720){</b>
<b class="nc"><i>753</i>&nbsp;                    screenSizeError.setText(&quot;Your device doesn&#39;t support 1280 x 720 resolution&quot;);</b>
<b class="nc"><i>754</i>&nbsp;                    screenSizeError.setVisible(true);</b>
<b class="nc"><i>755</i>&nbsp;                    screenSizeOptions.getSelectionModel().selectFirst();</b>
<i>756</i>&nbsp;                } else {
<b class="nc"><i>757</i>&nbsp;                    screenSizeError.setVisible(false);</b>
<b class="nc"><i>758</i>&nbsp;                    this.screenWidth = 1280;</b>
<b class="nc"><i>759</i>&nbsp;                    this.screenHeight = 720;</b>
<i>760</i>&nbsp;                }
<i>761</i>&nbsp;                break;
<i>762</i>&nbsp;        }
<i>763</i>&nbsp;    }
<i>764</i>&nbsp;
<i>765</i>&nbsp;    /**
<i>766</i>&nbsp;     * This method closes primary window and the client when user clicks on quit and confirms their action
<i>767</i>&nbsp;     */
<i>768</i>&nbsp;    public void closeProgram(){
<b class="nc"><i>769</i>&nbsp;        yesPopupButton.setOnAction(e -&gt; {</b>
<b class="nc"><i>770</i>&nbsp;            window.close();</b>
<i>771</i>&nbsp;            try {
<b class="nc"><i>772</i>&nbsp;                client.end();</b>
<b class="nc"><i>773</i>&nbsp;                menuScene.setClose();</b>
<b class="nc"><i>774</i>&nbsp;                matchScene.setCloseMatch();</b>
<b class="nc"><i>775</i>&nbsp;            } catch (ChannelClosedException ex) {</b>
<b class="nc"><i>776</i>&nbsp;                ex.printStackTrace();</b>
<b class="nc"><i>777</i>&nbsp;                System.err.println(&quot;Connection Lost&quot;);</b>
<b class="nc"><i>778</i>&nbsp;            }</b>
<i>779</i>&nbsp;
<i>780</i>&nbsp;        });
<b class="nc"><i>781</i>&nbsp;        noPopupButton.setOnAction(e -&gt; {</b>
<b class="nc"><i>782</i>&nbsp;            menuPage.setEffect(new BoxBlur(0, 0, 0));</b>
<b class="nc"><i>783</i>&nbsp;            openingPage.setEffect(new BoxBlur(0, 0, 0));</b>
<b class="nc"><i>784</i>&nbsp;            loadingPage.setEffect(new BoxBlur(0, 0, 0));</b>
<b class="nc"><i>785</i>&nbsp;            matchPage.setEffect(new BoxBlur(0, 0, 0));</b>
<b class="nc"><i>786</i>&nbsp;            transitionClouds.setEffect(new BoxBlur(0, 0, 0));</b>
<b class="nc"><i>787</i>&nbsp;            howToPlayBox.setEffect(new BoxBlur(0, 0, 0));</b>
<b class="nc"><i>788</i>&nbsp;            closePopup.setVisible(false);</b>
<i>789</i>&nbsp;        });
<b class="nc"><i>790</i>&nbsp;        createClosePopup();</b>
<i>791</i>&nbsp;    }
<i>792</i>&nbsp;
<i>793</i>&nbsp;    /**
<i>794</i>&nbsp;     * This method creates close popup, that asks if user is sure to quit the game
<i>795</i>&nbsp;     */
<i>796</i>&nbsp;    private void closePopup(){
<b class="nc"><i>797</i>&nbsp;        closePopup = new StackPane();</b>
<b class="nc"><i>798</i>&nbsp;        closePopup.setPrefWidth(screenWidth/4);</b>
<b class="nc"><i>799</i>&nbsp;        closePopup.setPrefHeight(screenHeight/4);</b>
<i>800</i>&nbsp;
<b class="nc"><i>801</i>&nbsp;        Image closeFrame = new Image(Gui.class.getResource(&quot;/img/loadingAndPopups/frame.png&quot;).toString(), screenWidth/2, screenHeight/2, false, false);</b>
<b class="nc"><i>802</i>&nbsp;        ImageView closeView = new ImageView(closeFrame);</b>
<i>803</i>&nbsp;
<b class="nc"><i>804</i>&nbsp;        VBox confirmBox = new VBox();</b>
<i>805</i>&nbsp;
<b class="nc"><i>806</i>&nbsp;        Text questionPopup = new Text(&quot;Do you really want to quit the game?&quot;);</b>
<b class="nc"><i>807</i>&nbsp;        questionPopup.setFont(Font.loadFont(Gui.class.getResourceAsStream(&quot;/fonts/LillyBelle.ttf&quot;), screenWidth/80));</b>
<b class="nc"><i>808</i>&nbsp;        HBox answers = new HBox();</b>
<b class="nc"><i>809</i>&nbsp;        yesPopupButton = new Button(&quot;Yes&quot;);</b>
<b class="nc"><i>810</i>&nbsp;        noPopupButton = new Button(&quot;No&quot;);</b>
<i>811</i>&nbsp;
<b class="nc"><i>812</i>&nbsp;        yesPopupButton.setFont(Font.loadFont(Gui.class.getResourceAsStream(&quot;/fonts/LillyBelle.ttf&quot;), screenWidth/80));</b>
<b class="nc"><i>813</i>&nbsp;        yesPopupButton.setCursor(Cursor.HAND);</b>
<b class="nc"><i>814</i>&nbsp;        noPopupButton.setFont(Font.loadFont(Gui.class.getResourceAsStream(&quot;/fonts/LillyBelle.ttf&quot;), screenWidth/80));</b>
<b class="nc"><i>815</i>&nbsp;        noPopupButton.setCursor(Cursor.HAND);</b>
<i>816</i>&nbsp;
<i>817</i>&nbsp;
<i>818</i>&nbsp;
<b class="nc"><i>819</i>&nbsp;        answers.getChildren().addAll(yesPopupButton, noPopupButton);</b>
<b class="nc"><i>820</i>&nbsp;        answers.setSpacing(50);</b>
<b class="nc"><i>821</i>&nbsp;        answers.setAlignment(Pos.CENTER);</b>
<i>822</i>&nbsp;
<i>823</i>&nbsp;
<i>824</i>&nbsp;
<i>825</i>&nbsp;
<b class="nc"><i>826</i>&nbsp;        confirmBox.setSpacing(10);</b>
<b class="nc"><i>827</i>&nbsp;        confirmBox.getChildren().addAll(questionPopup, answers);</b>
<i>828</i>&nbsp;
<b class="nc"><i>829</i>&nbsp;        closePopup.getChildren().addAll(closeView, confirmBox);</b>
<b class="nc"><i>830</i>&nbsp;        closePopup.setAlignment(Pos.CENTER);</b>
<b class="nc"><i>831</i>&nbsp;        confirmBox.setAlignment(Pos.CENTER);</b>
<i>832</i>&nbsp;
<i>833</i>&nbsp;    }
<i>834</i>&nbsp;
<i>835</i>&nbsp;    /**
<i>836</i>&nbsp;     * This method shows close popup
<i>837</i>&nbsp;     */
<i>838</i>&nbsp;    private void createClosePopup(){
<b class="nc"><i>839</i>&nbsp;        menuPage.setEffect(new BoxBlur(5, 10, 10));</b>
<b class="nc"><i>840</i>&nbsp;        openingPage.setEffect(new BoxBlur(5, 10, 10));</b>
<b class="nc"><i>841</i>&nbsp;        loadingPage.setEffect(new BoxBlur(5, 10, 10));</b>
<b class="nc"><i>842</i>&nbsp;        matchPage.setEffect(new BoxBlur(5, 10, 10));</b>
<b class="nc"><i>843</i>&nbsp;        transitionClouds.setEffect(new BoxBlur(5, 10, 10));</b>
<b class="nc"><i>844</i>&nbsp;        howToPlayBox.setEffect(new BoxBlur(5, 10, 10));</b>
<b class="nc"><i>845</i>&nbsp;        closePopup.setVisible(true);</b>
<i>846</i>&nbsp;    }
<i>847</i>&nbsp;
<i>848</i>&nbsp;
<i>849</i>&nbsp;    /**
<i>850</i>&nbsp;     * This method creates opening page and after that calls the method that creates menu scene
<i>851</i>&nbsp;     */
<i>852</i>&nbsp;    private void openingPage(){
<b class="nc"><i>853</i>&nbsp;        Image openingImg = new Image(Gui.class.getResource(&quot;/img/opening/opening.png&quot;).toString(), screenWidth, screenHeight, false, false);</b>
<b class="nc"><i>854</i>&nbsp;        ImageView openingView = new ImageView(openingImg);</b>
<b class="nc"><i>855</i>&nbsp;        Image logoImg = new Image(Gui.class.getResource(&quot;/img/opening/logo.png&quot;).toString(), screenWidth/2, screenHeight/2, false, false);</b>
<b class="nc"><i>856</i>&nbsp;        ImageView logoView = new ImageView(logoImg);</b>
<i>857</i>&nbsp;
<b class="nc"><i>858</i>&nbsp;        openingPage.getChildren().addAll(openingView, logoView);</b>
<b class="nc"><i>859</i>&nbsp;        openingPage.setAlignment(Pos.CENTER);</b>
<b class="nc"><i>860</i>&nbsp;        openingView.setVisible(true);</b>
<b class="nc"><i>861</i>&nbsp;        logoView.setVisible(false);</b>
<i>862</i>&nbsp;
<i>863</i>&nbsp;
<b class="nc"><i>864</i>&nbsp;        FadeTransition openingFadeIn = new FadeTransition(Duration.millis(2000), openingPage);</b>
<b class="nc"><i>865</i>&nbsp;        openingFadeIn.setFromValue(0.0);</b>
<b class="nc"><i>866</i>&nbsp;        openingFadeIn.setToValue(1.0);</b>
<b class="nc"><i>867</i>&nbsp;        FadeTransition openingFadeOut = new FadeTransition(Duration.millis(2000), openingPage);</b>
<b class="nc"><i>868</i>&nbsp;        openingFadeOut.setFromValue(1.0);</b>
<b class="nc"><i>869</i>&nbsp;        openingFadeOut.setToValue(0.0);</b>
<i>870</i>&nbsp;
<i>871</i>&nbsp;
<b class="nc"><i>872</i>&nbsp;        openingFadeIn.play();</b>
<i>873</i>&nbsp;
<b class="nc"><i>874</i>&nbsp;        Timeline firstTimer = new Timeline(new KeyFrame(</b>
<b class="nc"><i>875</i>&nbsp;                Duration.millis(2000),</b>
<i>876</i>&nbsp;                ae -&gt; {
<b class="nc"><i>877</i>&nbsp;                    openingFadeOut.play();</b>
<i>878</i>&nbsp;                }));
<b class="nc"><i>879</i>&nbsp;        firstTimer.play();</b>
<i>880</i>&nbsp;
<b class="nc"><i>881</i>&nbsp;        Timeline secondTimer = new Timeline(new KeyFrame(</b>
<b class="nc"><i>882</i>&nbsp;                Duration.millis(4000),</b>
<i>883</i>&nbsp;                ae -&gt; {
<b class="nc"><i>884</i>&nbsp;                    openingFadeIn.play();</b>
<b class="nc"><i>885</i>&nbsp;                    logoView.setVisible(true);</b>
<b class="nc"><i>886</i>&nbsp;                    openingView.setVisible(false);</b>
<i>887</i>&nbsp;                }));
<b class="nc"><i>888</i>&nbsp;        secondTimer.play();</b>
<i>889</i>&nbsp;
<b class="nc"><i>890</i>&nbsp;        Timeline thirdTimer = new Timeline(new KeyFrame(</b>
<b class="nc"><i>891</i>&nbsp;                Duration.millis(6000),</b>
<i>892</i>&nbsp;                ae -&gt; {
<b class="nc"><i>893</i>&nbsp;                    openingFadeOut.play();</b>
<i>894</i>&nbsp;                }));
<b class="nc"><i>895</i>&nbsp;        thirdTimer.play();</b>
<i>896</i>&nbsp;
<b class="nc"><i>897</i>&nbsp;        Timeline menuTimer = new Timeline(new KeyFrame(</b>
<b class="nc"><i>898</i>&nbsp;                Duration.millis(8000),</b>
<i>899</i>&nbsp;                ae -&gt; {
<b class="nc"><i>900</i>&nbsp;                    openingPage.setVisible(false);</b>
<b class="nc"><i>901</i>&nbsp;                    menuScene = new MenuScene(this, menuPage, screenWidth, screenHeight, loadingPage, howToPlayBox);</b>
<b class="nc"><i>902</i>&nbsp;                    menuScene.setMenuScene();</b>
<b class="nc"><i>903</i>&nbsp;                    setGameIsReady();</b>
<b class="nc"><i>904</i>&nbsp;                    setInMenuPage(true);</b>
<i>905</i>&nbsp;                }));
<b class="nc"><i>906</i>&nbsp;        menuTimer.play();</b>
<i>907</i>&nbsp;    }
<i>908</i>&nbsp;
<i>909</i>&nbsp;    /**
<i>910</i>&nbsp;     * This method creates clouds animation
<i>911</i>&nbsp;     */
<i>912</i>&nbsp;    private void createTransitionClouds(){
<b class="nc"><i>913</i>&nbsp;        transitionClouds = new StackPane();</b>
<b class="nc"><i>914</i>&nbsp;        Image leftCloudImg = new Image(Gui.class.getResource(&quot;/img/loadingAndPopups/transitionCloudLeft.png&quot;).toString(), screenWidth, screenHeight*2, false, false);</b>
<b class="nc"><i>915</i>&nbsp;        ImageView leftCloud = new ImageView(leftCloudImg);</b>
<b class="nc"><i>916</i>&nbsp;        Image rightCloudImg = new Image(Gui.class.getResource(&quot;/img/loadingAndPopups/transitionCloudRight.png&quot;).toString(), screenWidth, screenHeight*2, false, false);</b>
<b class="nc"><i>917</i>&nbsp;        ImageView rightCloud = new ImageView(rightCloudImg);</b>
<i>918</i>&nbsp;
<b class="nc"><i>919</i>&nbsp;        transitionClouds.getChildren().addAll(rightCloud, leftCloud);</b>
<i>920</i>&nbsp;
<b class="nc"><i>921</i>&nbsp;        translateLeftTransitionIn = new TranslateTransition(Duration.millis(1500), leftCloud);</b>
<b class="nc"><i>922</i>&nbsp;        translateLeftTransitionIn.setFromX(-screenWidth);</b>
<b class="nc"><i>923</i>&nbsp;        translateLeftTransitionIn.setByX(screenWidth-screenWidth/4);</b>
<b class="nc"><i>924</i>&nbsp;        translateLeftTransitionIn.setAutoReverse(true);</b>
<i>925</i>&nbsp;
<b class="nc"><i>926</i>&nbsp;        translateRightTransitionIn = new TranslateTransition(Duration.millis(1500), rightCloud);</b>
<b class="nc"><i>927</i>&nbsp;        translateRightTransitionIn.setFromX(screenWidth);</b>
<b class="nc"><i>928</i>&nbsp;        translateRightTransitionIn.setByX(-screenWidth+screenWidth/4);</b>
<b class="nc"><i>929</i>&nbsp;        translateRightTransitionIn.setAutoReverse(true);</b>
<i>930</i>&nbsp;    }
<i>931</i>&nbsp;
<i>932</i>&nbsp;    /**
<i>933</i>&nbsp;     * This method plays clouds animation
<i>934</i>&nbsp;     */
<i>935</i>&nbsp;    public void playTransitionClouds(){
<b class="nc"><i>936</i>&nbsp;        transitionClouds.setVisible(true);</b>
<b class="nc"><i>937</i>&nbsp;        translateLeftTransitionIn.setCycleCount(2);</b>
<b class="nc"><i>938</i>&nbsp;        translateLeftTransitionIn.play();</b>
<b class="nc"><i>939</i>&nbsp;        translateRightTransitionIn.setCycleCount(2);</b>
<b class="nc"><i>940</i>&nbsp;        translateRightTransitionIn.play();</b>
<b class="nc"><i>941</i>&nbsp;        Timeline cloudsTimer = new Timeline(new KeyFrame(</b>
<b class="nc"><i>942</i>&nbsp;                Duration.millis(3000),</b>
<i>943</i>&nbsp;                ae -&gt; {
<b class="nc"><i>944</i>&nbsp;                    transitionClouds.setVisible(false);</b>
<i>945</i>&nbsp;                }));
<b class="nc"><i>946</i>&nbsp;        cloudsTimer.play();</b>
<i>947</i>&nbsp;    }
<i>948</i>&nbsp;
<i>949</i>&nbsp;    /**
<i>950</i>&nbsp;     * This method creates connection error pane
<i>951</i>&nbsp;     */
<i>952</i>&nbsp;    private void createConnectionErrorPane(){
<b class="nc"><i>953</i>&nbsp;        connectionError = new StackPane();</b>
<i>954</i>&nbsp;
<b class="nc"><i>955</i>&nbsp;        Image connectionFrame = new Image(MatchScene.class.getResource(&quot;/img/loadingAndPopups/frame2.png&quot;).toString(), screenWidth/3, screenHeight/3, false, false);</b>
<b class="nc"><i>956</i>&nbsp;        ImageView connectionErrorView = new ImageView(connectionFrame);</b>
<i>957</i>&nbsp;
<b class="nc"><i>958</i>&nbsp;        VBox connectionErrorBox = new VBox();</b>
<b class="nc"><i>959</i>&nbsp;        connectionErrorBox.setSpacing(screenHeight/30);</b>
<i>960</i>&nbsp;        //connection error message
<b class="nc"><i>961</i>&nbsp;        Text connectionErrorMessage = new Text(&quot;Connection lost&quot;);</b>
<b class="nc"><i>962</i>&nbsp;        connectionErrorMessage.setFont(lillybelleFont);</b>
<b class="nc"><i>963</i>&nbsp;        connectionErrorMessage.setFill(DARKRED);</b>
<i>964</i>&nbsp;
<b class="nc"><i>965</i>&nbsp;        Button okConnectionButton = new Button(&quot;Ok&quot;);</b>
<b class="nc"><i>966</i>&nbsp;        okConnectionButton.setFont(lillybelleFont);</b>
<i>967</i>&nbsp;
<b class="nc"><i>968</i>&nbsp;        okConnectionButton.setOnMouseEntered(e -&gt; {</b>
<b class="nc"><i>969</i>&nbsp;            okConnectionButton.setCursor(Cursor.HAND);</b>
<i>970</i>&nbsp;        });
<b class="nc"><i>971</i>&nbsp;        okConnectionButton.setOnMouseExited(e -&gt; {</b>
<b class="nc"><i>972</i>&nbsp;            okConnectionButton.setCursor(Cursor.DEFAULT);</b>
<i>973</i>&nbsp;        });
<b class="nc"><i>974</i>&nbsp;        okConnectionButton.setOnAction(e -&gt; {</b>
<b class="nc"><i>975</i>&nbsp;            menuScene.setClose();</b>
<b class="nc"><i>976</i>&nbsp;            matchScene.setCloseMatch();</b>
<b class="nc"><i>977</i>&nbsp;            setIsConnectionError(true);</b>
<b class="nc"><i>978</i>&nbsp;            createSettingStage(new Stage());</b>
<b class="nc"><i>979</i>&nbsp;            window.close();</b>
<b class="nc"><i>980</i>&nbsp;            window = null;</b>
<i>981</i>&nbsp;        });
<i>982</i>&nbsp;
<b class="nc"><i>983</i>&nbsp;        connectionErrorBox.getChildren().addAll(connectionErrorMessage, okConnectionButton);</b>
<i>984</i>&nbsp;
<b class="nc"><i>985</i>&nbsp;        connectionError.getChildren().addAll(connectionErrorView, connectionErrorBox);</b>
<b class="nc"><i>986</i>&nbsp;        connectionErrorBox.setAlignment(Pos.CENTER);</b>
<i>987</i>&nbsp;    }
<i>988</i>&nbsp;
<i>989</i>&nbsp;    /**
<i>990</i>&nbsp;     * This method shows connection error pane
<i>991</i>&nbsp;     */
<i>992</i>&nbsp;    public void showConnectionError(){
<b class="nc"><i>993</i>&nbsp;        FadeTransition paneFadeIn = new FadeTransition(Duration.millis(500), connectionError);</b>
<b class="nc"><i>994</i>&nbsp;        paneFadeIn.setFromValue(0);</b>
<b class="nc"><i>995</i>&nbsp;        paneFadeIn.setToValue(1);</b>
<b class="nc"><i>996</i>&nbsp;        paneFadeIn.play();</b>
<b class="nc"><i>997</i>&nbsp;        connectionError.setVisible(true);</b>
<i>998</i>&nbsp;
<b class="nc"><i>999</i>&nbsp;        Timeline showingTimer = new Timeline(new KeyFrame(</b>
<b class="nc"><i>1000</i>&nbsp;                Duration.millis(500),</b>
<i>1001</i>&nbsp;                ae -&gt; {
<b class="nc"><i>1002</i>&nbsp;                    matchScene.matchBackground().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1003</i>&nbsp;                    matchScene.mapView().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1004</i>&nbsp;                    matchScene.playerViewPane().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1005</i>&nbsp;                    matchScene.guiMap().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1006</i>&nbsp;                    matchScene.pausePane().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1007</i>&nbsp;                    matchScene.activePowers().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1008</i>&nbsp;                    matchScene.helper().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1009</i>&nbsp;                    matchScene.turnStory().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1010</i>&nbsp;                    matchScene.myTurn().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1011</i>&nbsp;                    matchScene.chooseCardsBox().setEffect(new BoxBlur(5, 5, 5));</b>
<b class="nc"><i>1012</i>&nbsp;                    matchScene.chooseCardPane().setEffect(new BoxBlur(5, 5, 5));</b>
<i>1013</i>&nbsp;                }));
<b class="nc"><i>1014</i>&nbsp;        showingTimer.play();</b>
<i>1015</i>&nbsp;    }
<i>1016</i>&nbsp;
<i>1017</i>&nbsp;
<i>1018</i>&nbsp;    /**
<i>1019</i>&nbsp;     * This method creates all the form about connection
<i>1020</i>&nbsp;     */
<i>1021</i>&nbsp;    private synchronized void askConnection(){
<b class="nc"><i>1022</i>&nbsp;        closeWindow.set(false);</b>
<b class="nc"><i>1023</i>&nbsp;        valid = new AtomicBoolean(false);</b>
<b class="nc"><i>1024</i>&nbsp;        AtomicBoolean validPort = new AtomicBoolean(false);</b>
<b class="nc"><i>1025</i>&nbsp;        ipForm.setVisible(true);</b>
<b class="nc"><i>1026</i>&nbsp;        ipFormField.setVisible(true);</b>
<b class="nc"><i>1027</i>&nbsp;        portForm.setVisible(true);</b>
<b class="nc"><i>1028</i>&nbsp;        portFormField.setVisible(true);</b>
<b class="nc"><i>1029</i>&nbsp;        connectionButton.setVisible(true);</b>
<b class="nc"><i>1030</i>&nbsp;        connectionButton.setManaged(true);</b>
<b class="nc"><i>1031</i>&nbsp;        loadingIcon.setVisible(false);</b>
<b class="nc"><i>1032</i>&nbsp;        loadingIcon.setManaged(false);</b>
<b class="nc"><i>1033</i>&nbsp;        clicked.set(false);</b>
<b class="nc"><i>1034</i>&nbsp;        setIp(null);</b>
<b class="nc"><i>1035</i>&nbsp;        ipFormField.clear();</b>
<b class="nc"><i>1036</i>&nbsp;        portFormField.clear();</b>
<b class="nc"><i>1037</i>&nbsp;        while (!valid.get() &amp;&amp; !closeWindow.get()) {</b>
<b class="nc"><i>1038</i>&nbsp;            clicked.set(false);</b>
<b class="nc"><i>1039</i>&nbsp;            ipFormField.clear();</b>
<b class="nc"><i>1040</i>&nbsp;            portFormField.clear();</b>
<b class="nc"><i>1041</i>&nbsp;            connectionButton.setOnMouseClicked(e -&gt; {</b>
<b class="nc"><i>1042</i>&nbsp;                loadingIcon.setVisible(true);</b>
<b class="nc"><i>1043</i>&nbsp;                loadingIcon.setManaged(true);</b>
<b class="nc"><i>1044</i>&nbsp;                connectionButton.setVisible(false);</b>
<b class="nc"><i>1045</i>&nbsp;                connectionButton.setManaged(false);</b>
<b class="nc"><i>1046</i>&nbsp;                if (ipFormField.getText().isEmpty()) {      //if ip form is empty -&gt; valid is false and error message</b>
<b class="nc"><i>1047</i>&nbsp;                    errorMessage.setVisible(true);</b>
<b class="nc"><i>1048</i>&nbsp;                    errorMessage.setManaged(true);</b>
<b class="nc"><i>1049</i>&nbsp;                    setErrorMessage(&quot;You have to insert an Ip Address&quot;);</b>
<b class="nc"><i>1050</i>&nbsp;                    loadingIcon.setVisible(false);</b>
<b class="nc"><i>1051</i>&nbsp;                    loadingIcon.setManaged(false);</b>
<b class="nc"><i>1052</i>&nbsp;                    connectionButton.setVisible(true);</b>
<b class="nc"><i>1053</i>&nbsp;                    connectionButton.setManaged(true);</b>
<b class="nc"><i>1054</i>&nbsp;                } else if (portFormField.getText().isEmpty()) {     //if port form is empty -&gt; valid is false and error message</b>
<b class="nc"><i>1055</i>&nbsp;                    errorMessage.setVisible(true);</b>
<b class="nc"><i>1056</i>&nbsp;                    errorMessage.setManaged(true);</b>
<b class="nc"><i>1057</i>&nbsp;                    setErrorMessage(&quot;You have to insert a port number&quot;);</b>
<b class="nc"><i>1058</i>&nbsp;                    loadingIcon.setVisible(false);</b>
<b class="nc"><i>1059</i>&nbsp;                    loadingIcon.setManaged(false);</b>
<b class="nc"><i>1060</i>&nbsp;                    connectionButton.setVisible(true);</b>
<b class="nc"><i>1061</i>&nbsp;                    connectionButton.setManaged(true);</b>
<i>1062</i>&nbsp;                } else {
<i>1063</i>&nbsp;                    try {
<b class="nc"><i>1064</i>&nbsp;                        setPort(Integer.parseInt(portFormField.getText()));     //if user insert a number&gt;1023 validPort is true</b>
<b class="nc"><i>1065</i>&nbsp;                        errorMessage.setVisible(false);</b>
<b class="nc"><i>1066</i>&nbsp;                        errorMessage.setManaged(false);</b>
<b class="nc"><i>1067</i>&nbsp;                        if(port()&gt;1023)</b>
<b class="nc"><i>1068</i>&nbsp;                            validPort.set(true);</b>
<i>1069</i>&nbsp;                        else {
<b class="nc"><i>1070</i>&nbsp;                            setPort(0);</b>
<b class="nc"><i>1071</i>&nbsp;                            setErrorMessage(&quot;Not valid port number&quot;);</b>
<b class="nc"><i>1072</i>&nbsp;                            loadingIcon.setVisible(false);</b>
<b class="nc"><i>1073</i>&nbsp;                            loadingIcon.setManaged(false);</b>
<b class="nc"><i>1074</i>&nbsp;                            connectionButton.setVisible(true);</b>
<b class="nc"><i>1075</i>&nbsp;                            connectionButton.setManaged(true);</b>
<i>1076</i>&nbsp;                        }
<b class="nc"><i>1077</i>&nbsp;                    } catch (Exception notInt) {</b>
<b class="nc"><i>1078</i>&nbsp;                        errorMessage.setVisible(true);</b>
<b class="nc"><i>1079</i>&nbsp;                        errorMessage.setManaged(true);</b>
<b class="nc"><i>1080</i>&nbsp;                        setErrorMessage(&quot;Port must be a number&quot;);</b>
<b class="nc"><i>1081</i>&nbsp;                        loadingIcon.setVisible(false);</b>
<b class="nc"><i>1082</i>&nbsp;                        loadingIcon.setManaged(false);</b>
<b class="nc"><i>1083</i>&nbsp;                        connectionButton.setVisible(true);</b>
<b class="nc"><i>1084</i>&nbsp;                        connectionButton.setManaged(true);</b>
<b class="nc"><i>1085</i>&nbsp;                    }</b>
<i>1086</i>&nbsp;                }
<b class="nc"><i>1087</i>&nbsp;                if(validPort.get()){</b>
<b class="nc"><i>1088</i>&nbsp;                    setIp(ipFormField.getText());</b>
<b class="nc"><i>1089</i>&nbsp;                    errorMessage.setVisible(false);</b>
<b class="nc"><i>1090</i>&nbsp;                    errorMessage.setManaged(false);</b>
<b class="nc"><i>1091</i>&nbsp;                    valid.set(true);</b>
<i>1092</i>&nbsp;                }
<b class="nc"><i>1093</i>&nbsp;                setClicked();</b>
<i>1094</i>&nbsp;            });
<b class="nc"><i>1095</i>&nbsp;            while (!clicked.get() &amp;&amp; !closeWindow.get()){</b>
<i>1096</i>&nbsp;                try {
<b class="nc"><i>1097</i>&nbsp;                    wait();</b>
<b class="nc"><i>1098</i>&nbsp;                } catch (InterruptedException ex) {</b>
<b class="nc"><i>1099</i>&nbsp;                    ex.printStackTrace();</b>
<b class="nc"><i>1100</i>&nbsp;                }</b>
<i>1101</i>&nbsp;            }
<i>1102</i>&nbsp;        }
<i>1103</i>&nbsp;    }
<i>1104</i>&nbsp;
<i>1105</i>&nbsp;    /**
<i>1106</i>&nbsp;     * This method is called when user has connected to server. It shows disconnection button and play button. Firstly it wait for user choice, then, if user chooses to play, waits for menu scene to be ready and displayed
<i>1107</i>&nbsp;     */
<i>1108</i>&nbsp;    public synchronized void prepareToStart(){
<b class="nc"><i>1109</i>&nbsp;        openGame = new AtomicBoolean(false);</b>
<b class="nc"><i>1110</i>&nbsp;        restartConnection = new AtomicBoolean(false);</b>
<i>1111</i>&nbsp;
<b class="nc"><i>1112</i>&nbsp;        loadingIcon.setManaged(false);</b>
<b class="nc"><i>1113</i>&nbsp;        loadingIcon.setVisible(false);</b>
<b class="nc"><i>1114</i>&nbsp;        connectionButton.setManaged(false);</b>
<b class="nc"><i>1115</i>&nbsp;        connectionButton.setVisible(false);</b>
<b class="nc"><i>1116</i>&nbsp;        connectedText.setManaged(true);</b>
<b class="nc"><i>1117</i>&nbsp;        connectedText.setVisible(true);</b>
<b class="nc"><i>1118</i>&nbsp;        disconnectionButton.setManaged(true);</b>
<b class="nc"><i>1119</i>&nbsp;        disconnectionButton.setVisible(true);</b>
<i>1120</i>&nbsp;
<b class="nc"><i>1121</i>&nbsp;        enterGameButton.setManaged(true);</b>
<b class="nc"><i>1122</i>&nbsp;        enterGameButton.setVisible(true);</b>
<i>1123</i>&nbsp;
<b class="nc"><i>1124</i>&nbsp;        disconnectionButton.setOnMouseEntered(e -&gt; {</b>
<b class="nc"><i>1125</i>&nbsp;            disconnectionButton.setCursor(Cursor.HAND);</b>
<i>1126</i>&nbsp;        });
<i>1127</i>&nbsp;
<b class="nc"><i>1128</i>&nbsp;        disconnectionButton.setOnMouseExited(e -&gt; {</b>
<b class="nc"><i>1129</i>&nbsp;            disconnectionButton.setCursor(Cursor.DEFAULT);</b>
<i>1130</i>&nbsp;        });
<i>1131</i>&nbsp;
<i>1132</i>&nbsp;        //if user clicks disconnect
<b class="nc"><i>1133</i>&nbsp;        disconnectionButton.setOnAction(e -&gt; {</b>
<b class="nc"><i>1134</i>&nbsp;            connectedText.setVisible(false);</b>
<b class="nc"><i>1135</i>&nbsp;            connectedText.setManaged(false);</b>
<b class="nc"><i>1136</i>&nbsp;            disconnectionButton.setVisible(false);</b>
<b class="nc"><i>1137</i>&nbsp;            disconnectionButton.setManaged(false);</b>
<b class="nc"><i>1138</i>&nbsp;            loadingIcon.setVisible(true);</b>
<b class="nc"><i>1139</i>&nbsp;            loadingIcon.setManaged(true);</b>
<b class="nc"><i>1140</i>&nbsp;            enterGameButton.setVisible(false);</b>
<b class="nc"><i>1141</i>&nbsp;            enterGameButton.setManaged(false);</b>
<b class="nc"><i>1142</i>&nbsp;            restartConnection();</b>
<i>1143</i>&nbsp;        });
<i>1144</i>&nbsp;
<i>1145</i>&nbsp;        //if user clicks on play
<b class="nc"><i>1146</i>&nbsp;        enterGameButton.setOnAction(e -&gt; {</b>
<b class="nc"><i>1147</i>&nbsp;            setOpenGame();</b>
<i>1148</i>&nbsp;        });
<i>1149</i>&nbsp;
<i>1150</i>&nbsp;
<b class="nc"><i>1151</i>&nbsp;        while (!openGame.get() &amp;&amp; !restartConnection.get() &amp;&amp; !closeWindow.get()){</b>
<i>1152</i>&nbsp;            try {
<b class="nc"><i>1153</i>&nbsp;                wait();</b>
<b class="nc"><i>1154</i>&nbsp;            } catch (InterruptedException ex) {</b>
<b class="nc"><i>1155</i>&nbsp;                ex.printStackTrace();</b>
<b class="nc"><i>1156</i>&nbsp;            }</b>
<i>1157</i>&nbsp;        }
<b class="nc"><i>1158</i>&nbsp;        if(openGame.get()){</b>
<b class="nc"><i>1159</i>&nbsp;            Platform.runLater(() -&gt; settingStage.close());</b>
<b class="nc"><i>1160</i>&nbsp;            Platform.runLater(this::primaryScene);</b>
<i>1161</i>&nbsp;        }
<b class="nc"><i>1162</i>&nbsp;        while (!gameIsReady.get() &amp;&amp; !restartConnection.get() &amp;&amp; !closeWindow.get()){</b>
<i>1163</i>&nbsp;            try {
<b class="nc"><i>1164</i>&nbsp;                wait();</b>
<b class="nc"><i>1165</i>&nbsp;            } catch (InterruptedException e) {</b>
<b class="nc"><i>1166</i>&nbsp;                e.printStackTrace();</b>
<b class="nc"><i>1167</i>&nbsp;            }</b>
<i>1168</i>&nbsp;        }
<i>1169</i>&nbsp;    }
<i>1170</i>&nbsp;
<i>1171</i>&nbsp;    /**
<i>1172</i>&nbsp;     * This method starts the match and shows match scene
<i>1173</i>&nbsp;     * It waits for the match scene to be ready and then returns
<i>1174</i>&nbsp;     */
<i>1175</i>&nbsp;    public synchronized void startMatch() {
<b class="nc"><i>1176</i>&nbsp;        readyForTheMatch.set(false);</b>
<b class="nc"><i>1177</i>&nbsp;        playTransitionClouds();</b>
<i>1178</i>&nbsp;
<b class="nc"><i>1179</i>&nbsp;        Platform.runLater(() -&gt; matchScene.setMatchScene(nickname, numberOfPlayers, color, opponents));</b>
<b class="nc"><i>1180</i>&nbsp;        FadeTransition loadingFadeOut = new FadeTransition(Duration.millis(2000), loadingPage);</b>
<b class="nc"><i>1181</i>&nbsp;        loadingFadeOut.setFromValue(1);</b>
<b class="nc"><i>1182</i>&nbsp;        loadingFadeOut.setToValue(0);</b>
<b class="nc"><i>1183</i>&nbsp;        loadingFadeOut.play();</b>
<i>1184</i>&nbsp;
<b class="nc"><i>1185</i>&nbsp;        Timeline matchTimer = new Timeline(new KeyFrame(</b>
<b class="nc"><i>1186</i>&nbsp;                Duration.millis(1500),</b>
<i>1187</i>&nbsp;                ae -&gt; {
<b class="nc"><i>1188</i>&nbsp;                    loadingPage.setVisible(false);</b>
<b class="nc"><i>1189</i>&nbsp;                    FadeTransition matchFade = new FadeTransition(Duration.millis(2000), matchPage);</b>
<b class="nc"><i>1190</i>&nbsp;                    matchFade.setFromValue(0.0);</b>
<b class="nc"><i>1191</i>&nbsp;                    matchFade.setToValue(1.0);</b>
<b class="nc"><i>1192</i>&nbsp;                    matchFade.play();</b>
<b class="nc"><i>1193</i>&nbsp;                    matchPage.setVisible(true);</b>
<b class="nc"><i>1194</i>&nbsp;                    setReadyForTheMatch();</b>
<i>1195</i>&nbsp;                }));
<b class="nc"><i>1196</i>&nbsp;        matchTimer.play();</b>
<i>1197</i>&nbsp;
<b class="nc"><i>1198</i>&nbsp;        while (!readyForTheMatch.get()) {</b>
<i>1199</i>&nbsp;            try {
<b class="nc"><i>1200</i>&nbsp;                wait();</b>
<b class="nc"><i>1201</i>&nbsp;            } catch (InterruptedException e) {</b>
<b class="nc"><i>1202</i>&nbsp;                e.printStackTrace();</b>
<b class="nc"><i>1203</i>&nbsp;            }</b>
<i>1204</i>&nbsp;        }
<i>1205</i>&nbsp;    }
<i>1206</i>&nbsp;
<i>1207</i>&nbsp;    /**
<i>1208</i>&nbsp;     * This method restarts client
<i>1209</i>&nbsp;     */
<i>1210</i>&nbsp;    public void restartClient(){
<i>1211</i>&nbsp;        try {
<b class="nc"><i>1212</i>&nbsp;            client.restartClient();</b>
<b class="nc"><i>1213</i>&nbsp;        } catch (ChannelClosedException e) {</b>
<b class="nc"><i>1214</i>&nbsp;            e.printStackTrace();</b>
<b class="nc"><i>1215</i>&nbsp;        }</b>
<i>1216</i>&nbsp;    }
<i>1217</i>&nbsp;
<i>1218</i>&nbsp;    /**
<i>1219</i>&nbsp;     * This method asks ip to user
<i>1220</i>&nbsp;     * If the user had already connected to server and wants to play a new match, this method returns saved ip without asking it to user again
<i>1221</i>&nbsp;     * @return Ip address
<i>1222</i>&nbsp;     */
<i>1223</i>&nbsp;    @Override
<i>1224</i>&nbsp;    public String askIp() {
<b class="nc"><i>1225</i>&nbsp;        if(!secondMatch){</b>
<b class="nc"><i>1226</i>&nbsp;            askConnection();</b>
<i>1227</i>&nbsp;        }
<b class="nc"><i>1228</i>&nbsp;        return ip;</b>
<i>1229</i>&nbsp;    }
<i>1230</i>&nbsp;
<i>1231</i>&nbsp;    /**
<i>1232</i>&nbsp;     * This method asks port to user
<i>1233</i>&nbsp;     * If the user had already connected to server and wants to play a new match, this method returns saved port without asking it to user again
<i>1234</i>&nbsp;     * @return Port number
<i>1235</i>&nbsp;     */
<i>1236</i>&nbsp;    @Override
<i>1237</i>&nbsp;    public int askPort() {
<b class="nc"><i>1238</i>&nbsp;        return port;</b>
<i>1239</i>&nbsp;    }
<i>1240</i>&nbsp;
<i>1241</i>&nbsp;    /**
<i>1242</i>&nbsp;     * This method asks username to user
<i>1243</i>&nbsp;     * If the user had already connected to server and wants to play a new match, this method returns saved username without asking it to user again, if key is USERNAME
<i>1244</i>&nbsp;     * If the user is in the setting window the method calls prepareToStart
<i>1245</i>&nbsp;     * If the user clicks on disconnect, this method doesn&#39;t ask username and returns null
<i>1246</i>&nbsp;     * @param key Key that could be USERNAME or UNIQUE_USERNAME
<i>1247</i>&nbsp;     * @return Username
<i>1248</i>&nbsp;     */
<i>1249</i>&nbsp;    @Override
<i>1250</i>&nbsp;    public String askUserName(CommunicationProtocol key) {
<b class="nc"><i>1251</i>&nbsp;        if(key == CommunicationProtocol.USERNAME &amp;&amp; !secondMatch) {</b>
<b class="nc"><i>1252</i>&nbsp;            if (!inMenuPage)</b>
<b class="nc"><i>1253</i>&nbsp;                prepareToStart();</b>
<b class="nc"><i>1254</i>&nbsp;            if (!restartConnection.get() &amp;&amp; !closeWindow.get())</b>
<b class="nc"><i>1255</i>&nbsp;                nickname = menuScene.askNickname();</b>
<b class="nc"><i>1256</i>&nbsp;        } else if (key == CommunicationProtocol.UNIQUE_USERNAME){</b>
<b class="nc"><i>1257</i>&nbsp;            if (!inMenuPage)</b>
<b class="nc"><i>1258</i>&nbsp;                prepareToStart();</b>
<b class="nc"><i>1259</i>&nbsp;            if (!restartConnection.get() &amp;&amp; !closeWindow.get())</b>
<b class="nc"><i>1260</i>&nbsp;                nickname = menuScene.askNickname();</b>
<i>1261</i>&nbsp;        }
<b class="nc"><i>1262</i>&nbsp;        return nickname;</b>
<i>1263</i>&nbsp;    }
<i>1264</i>&nbsp;
<i>1265</i>&nbsp;    /**
<i>1266</i>&nbsp;     * This method asks match type to user
<i>1267</i>&nbsp;     * @return Match type
<i>1268</i>&nbsp;     */
<i>1269</i>&nbsp;    @Override
<i>1270</i>&nbsp;    public int askMatchType() {
<b class="nc"><i>1271</i>&nbsp;        numberOfPlayers = menuScene.askNumberOfPlayers();</b>
<b class="nc"><i>1272</i>&nbsp;        return numberOfPlayers;</b>
<i>1273</i>&nbsp;    }
<i>1274</i>&nbsp;
<i>1275</i>&nbsp;
<i>1276</i>&nbsp;    /**
<i>1277</i>&nbsp;     * This method asks a box from a given list. It is called for choosing workers starting position, worker for the current turn, destination of a move, a build or a remove
<i>1278</i>&nbsp;     * @param positions List of possible boxes
<i>1279</i>&nbsp;     * @return Chosen box
<i>1280</i>&nbsp;     * @throws TimeOutException Exception thrown when the time to do an action runs out
<i>1281</i>&nbsp;     */
<i>1282</i>&nbsp;    @Override
<i>1283</i>&nbsp;    public int askPosition(List&lt;int[]&gt; positions) throws TimeOutException {
<b class="nc"><i>1284</i>&nbsp;        Platform.runLater(() -&gt; matchScene.chooseDestination(positions));</b>
<b class="nc"><i>1285</i>&nbsp;        Platform.runLater(() -&gt; matchScene.playerView().playTimer(false, false));</b>
<b class="nc"><i>1286</i>&nbsp;        return matchScene.chosenDestination();</b>
<i>1287</i>&nbsp;    }
<i>1288</i>&nbsp;
<i>1289</i>&nbsp;    /**
<i>1290</i>&nbsp;     * This method asks cards of the match to challenger
<i>1291</i>&nbsp;     * @param cards List of all cards of the game
<i>1292</i>&nbsp;     * @return Chosen cards indexes
<i>1293</i>&nbsp;     * @throws TimeOutException Exception thrown when the time to do an action runs out
<i>1294</i>&nbsp;     */
<i>1295</i>&nbsp;    @Override
<i>1296</i>&nbsp;    public int[] askDeck(List&lt;GodCardProxy&gt; cards) throws TimeOutException {
<b class="nc"><i>1297</i>&nbsp;        Platform.runLater(() -&gt; matchScene.chooseCards(cards));</b>
<b class="nc"><i>1298</i>&nbsp;        Platform.runLater(() -&gt; matchScene.playerView().playTimer(true, false));</b>
<b class="nc"><i>1299</i>&nbsp;        return matchScene.chosenCards();</b>
<i>1300</i>&nbsp;    }
<i>1301</i>&nbsp;
<i>1302</i>&nbsp;    /** This method asks to user to chose a card to use in this match
<i>1303</i>&nbsp;     * @param cards List of all cards chosen by the challenger
<i>1304</i>&nbsp;     * @return Chosen card
<i>1305</i>&nbsp;     * @throws TimeOutException Exception thrown when the time to do an action runs out
<i>1306</i>&nbsp;     */
<i>1307</i>&nbsp;    @Override
<i>1308</i>&nbsp;    public int askCards(List&lt;GodCardProxy&gt; cards) throws TimeOutException {
<b class="nc"><i>1309</i>&nbsp;        Platform.runLater(() -&gt; matchScene.chooseCard(cards));</b>
<b class="nc"><i>1310</i>&nbsp;        Platform.runLater(() -&gt; matchScene.playerView().playTimer(false, true));</b>
<b class="nc"><i>1311</i>&nbsp;        return matchScene.chosenCard();</b>
<i>1312</i>&nbsp;    }
<i>1313</i>&nbsp;
<i>1314</i>&nbsp;    /**
<i>1315</i>&nbsp;     * This method asks confirmation to player
<i>1316</i>&nbsp;     * It could ask if player wants to use his power
<i>1317</i>&nbsp;     * It could ask if player wants to undo his turn
<i>1318</i>&nbsp;     * @param key Key that tells which is the request for the player
<i>1319</i>&nbsp;     * @return Answer by the player
<i>1320</i>&nbsp;     */
<i>1321</i>&nbsp;    @Override
<i>1322</i>&nbsp;    public int askConfirmation(CommunicationProtocol key) throws TimeOutException {
<b class="nc"><i>1323</i>&nbsp;        switch (key){</b>
<i>1324</i>&nbsp;            case UNDO:
<b class="nc"><i>1325</i>&nbsp;                return matchScene.showConfirmTurnPopup();</b>
<i>1326</i>&nbsp;            case GOD_POWER:
<b class="nc"><i>1327</i>&nbsp;                return matchScene.playerView().askUsePower();</b>
<i>1328</i>&nbsp;        }
<b class="nc"><i>1329</i>&nbsp;        return -1;</b>
<i>1330</i>&nbsp;    }
<i>1331</i>&nbsp;
<i>1332</i>&nbsp;    /**
<i>1333</i>&nbsp;     * This method asks worker to move in current turn
<i>1334</i>&nbsp;     * @param workers List of movable workers
<i>1335</i>&nbsp;     * @return Chosen worker position
<i>1336</i>&nbsp;     * @throws TimeOutException Exception thrown when the time to do an action runs out
<i>1337</i>&nbsp;     */
<i>1338</i>&nbsp;    @Override
<i>1339</i>&nbsp;    public int askWorker(List&lt;int[]&gt; workers) throws TimeOutException {
<b class="nc"><i>1340</i>&nbsp;        Platform.runLater(() -&gt; matchScene.playerView().playTimer(false, false));</b>
<b class="nc"><i>1341</i>&nbsp;        return askPosition(workers);</b>
<i>1342</i>&nbsp;    }
<i>1343</i>&nbsp;
<i>1344</i>&nbsp;    /**
<i>1345</i>&nbsp;     * This method shows different messages in the info box in match scene
<i>1346</i>&nbsp;     * @param key Key that tells which message to show
<i>1347</i>&nbsp;     */
<i>1348</i>&nbsp;    @Override
<i>1349</i>&nbsp;    public void prepareAdditionalCommunication(CommunicationProtocol key) {
<b class="nc"><i>1350</i>&nbsp;        switch (key){</b>
<i>1351</i>&nbsp;            case GOD_POWER:
<b class="nc"><i>1352</i>&nbsp;                Platform.runLater(() -&gt; matchScene.playerView().changeMessage(&quot;If you want to use your power click on the Power button, otherwise click on Confirm button to go on with the match&quot;));</b>
<b class="nc"><i>1353</i>&nbsp;                break;</b>
<i>1354</i>&nbsp;            case START_POSITION:
<b class="nc"><i>1355</i>&nbsp;                Platform.runLater(() -&gt; matchScene.playerView().changeMessage(&quot;Choose starting boxes for your workers&quot;));</b>
<b class="nc"><i>1356</i>&nbsp;                break;</b>
<i>1357</i>&nbsp;            case BUILD:
<b class="nc"><i>1358</i>&nbsp;                Platform.runLater(() -&gt; matchScene.playerView().changeMessage(&quot;Choose where to build&quot;));</b>
<b class="nc"><i>1359</i>&nbsp;                break;</b>
<i>1360</i>&nbsp;            case WORKER:
<b class="nc"><i>1361</i>&nbsp;                Platform.runLater(() -&gt; matchScene.playerView().changeMessage(&quot;Choose a worker for this turn&quot;));</b>
<b class="nc"><i>1362</i>&nbsp;                break;</b>
<i>1363</i>&nbsp;            case DESTINATION:
<b class="nc"><i>1364</i>&nbsp;                Platform.runLater(() -&gt; matchScene.playerView().changeMessage(&quot;Choose where to move&quot;));</b>
<b class="nc"><i>1365</i>&nbsp;                break;</b>
<i>1366</i>&nbsp;            case REMOVAL:
<b class="nc"><i>1367</i>&nbsp;                Platform.runLater(() -&gt; matchScene.playerView().changeMessage(&quot;Choose a block to remove&quot;));</b>
<i>1368</i>&nbsp;                break;
<i>1369</i>&nbsp;        }
<i>1370</i>&nbsp;
<i>1371</i>&nbsp;
<i>1372</i>&nbsp;    }
<i>1373</i>&nbsp;
<i>1374</i>&nbsp;    /**
<i>1375</i>&nbsp;     * This method updates the map with new positions and buildings
<i>1376</i>&nbsp;     * @param boxes List of all boxes of the map
<i>1377</i>&nbsp;     */
<i>1378</i>&nbsp;    @Override
<i>1379</i>&nbsp;    public void updateMap(List&lt;BoxProxy&gt; boxes) {
<b class="nc"><i>1380</i>&nbsp;        Platform.runLater(() -&gt; matchScene.map().clearMap());</b>
<b class="nc"><i>1381</i>&nbsp;        for(BoxProxy box : boxes){</b>
<b class="nc"><i>1382</i>&nbsp;            Platform.runLater(() -&gt; matchScene.map().box(box.position[0], box.position[1]).build(box.level, box.dome));</b>
<b class="nc"><i>1383</i>&nbsp;            if(box.occupier!=null){</b>
<i>1384</i>&nbsp;                //occupier color
<i>1385</i>&nbsp;                String occupierColor;
<b class="nc"><i>1386</i>&nbsp;                if(box.occupier.colour.equals(Colour.BLUE))</b>
<b class="nc"><i>1387</i>&nbsp;                    occupierColor = &quot;Blue&quot;;</b>
<b class="nc"><i>1388</i>&nbsp;                else if(box.occupier.colour.equals(Colour.WHITE))</b>
<b class="nc"><i>1389</i>&nbsp;                    occupierColor = &quot;White&quot;;</b>
<i>1390</i>&nbsp;                else
<b class="nc"><i>1391</i>&nbsp;                    occupierColor = &quot;Grey&quot;;</b>
<i>1392</i>&nbsp;                //occupier gender
<i>1393</i>&nbsp;                String gender;
<b class="nc"><i>1394</i>&nbsp;                if(box.occupier.gender)</b>
<b class="nc"><i>1395</i>&nbsp;                    gender = &quot;Female&quot;;</b>
<i>1396</i>&nbsp;                else
<b class="nc"><i>1397</i>&nbsp;                    gender = &quot;Male&quot;;</b>
<b class="nc"><i>1398</i>&nbsp;                Platform.runLater(() -&gt; matchScene.map().box(box.position[0], box.position[1]).moveWorker(occupierColor, gender));</b>
<i>1399</i>&nbsp;            }
<b class="nc"><i>1400</i>&nbsp;        }</b>
<i>1401</i>&nbsp;    }
<i>1402</i>&nbsp;
<i>1403</i>&nbsp;    /**
<i>1404</i>&nbsp;     * This method sets player view
<i>1405</i>&nbsp;     * If it is called for the first time it sets username and color
<i>1406</i>&nbsp;     * If it is called for the second time it sets player&#39;s card
<i>1407</i>&nbsp;     * @param player Player infos
<i>1408</i>&nbsp;     */
<i>1409</i>&nbsp;    @Override
<i>1410</i>&nbsp;    public void setMyPlayer(PlayerProxy player) {
<b class="nc"><i>1411</i>&nbsp;        if(player.godCardProxy==null){</b>
<b class="nc"><i>1412</i>&nbsp;            nickname = player.name;</b>
<b class="nc"><i>1413</i>&nbsp;            if(player.colour.equals(Colour.BLUE))</b>
<b class="nc"><i>1414</i>&nbsp;                color = &quot;Blue&quot;;</b>
<b class="nc"><i>1415</i>&nbsp;            else if(player.colour.equals(Colour.WHITE))</b>
<b class="nc"><i>1416</i>&nbsp;                color = &quot;White&quot;;</b>
<b class="nc"><i>1417</i>&nbsp;            else if(player.colour.equals(Colour.GREY))</b>
<b class="nc"><i>1418</i>&nbsp;                color = &quot;Grey&quot;;</b>
<i>1419</i>&nbsp;        } else {
<b class="nc"><i>1420</i>&nbsp;            Platform.runLater(() -&gt;matchScene.playerView().setMyCard(player));</b>
<i>1421</i>&nbsp;        }
<i>1422</i>&nbsp;    }
<i>1423</i>&nbsp;
<i>1424</i>&nbsp;    /**
<i>1425</i>&nbsp;     * This method sets opponent in player&#39;s view
<i>1426</i>&nbsp;     * If it is called for the first time it sets usernames and colors
<i>1427</i>&nbsp;     * If it is called for the second time it sets opponents&#39; cards
<i>1428</i>&nbsp;     * @param opponents Opponents infos
<i>1429</i>&nbsp;     */
<i>1430</i>&nbsp;    @Override
<i>1431</i>&nbsp;    public void setOpponentsInfo(List&lt;PlayerProxy&gt; opponents) {
<b class="nc"><i>1432</i>&nbsp;        if(opponents.get(0).godCardProxy==null) {</b>
<b class="nc"><i>1433</i>&nbsp;            this.opponents = opponents;</b>
<b class="nc"><i>1434</i>&nbsp;            startMatch();</b>
<i>1435</i>&nbsp;        }
<i>1436</i>&nbsp;        else
<b class="nc"><i>1437</i>&nbsp;            Platform.runLater(() -&gt; matchScene.playerView().setOpponentsCards(opponents));</b>
<i>1438</i>&nbsp;    }
<i>1439</i>&nbsp;
<i>1440</i>&nbsp;    /**
<i>1441</i>&nbsp;     * This method shows error of connection refused
<i>1442</i>&nbsp;     * @param host Host that refused the connection
<i>1443</i>&nbsp;     */
<i>1444</i>&nbsp;    @Override
<i>1445</i>&nbsp;    public void connectionFailed(String host) {
<b class="nc"><i>1446</i>&nbsp;        setErrorMessage(&quot;Connection refused&quot;);</b>
<i>1447</i>&nbsp;    }
<i>1448</i>&nbsp;
<i>1449</i>&nbsp;    /**
<i>1450</i>&nbsp;     * This method sets current player
<i>1451</i>&nbsp;     * @param player Current player
<i>1452</i>&nbsp;     */
<i>1453</i>&nbsp;    @Override
<i>1454</i>&nbsp;    public void setCurrentPlayer(PlayerProxy player) {
<b class="nc"><i>1455</i>&nbsp;        if(player.name.equals(nickname))</b>
<b class="nc"><i>1456</i>&nbsp;            Platform.runLater(() -&gt; matchScene.setMyTurn());</b>
<i>1457</i>&nbsp;        else {
<b class="nc"><i>1458</i>&nbsp;            Platform.runLater(() -&gt; matchScene.setOpponentTurn(player.name));</b>
<b class="nc"><i>1459</i>&nbsp;            Platform.runLater(() -&gt; matchScene.playerView().stopTimer());</b>
<i>1460</i>&nbsp;        }
<i>1461</i>&nbsp;    }
<i>1462</i>&nbsp;
<i>1463</i>&nbsp;    /**
<i>1464</i>&nbsp;     * This method tells what last player did in the last turn
<i>1465</i>&nbsp;     * @param events List of action made in the last turn
<i>1466</i>&nbsp;     */
<i>1467</i>&nbsp;    @Override
<i>1468</i>&nbsp;    public void tellStory(List&lt;String&gt; events) {
<i>1469</i>&nbsp;
<b class="nc"><i>1470</i>&nbsp;        for(String event : events){</b>
<b class="nc"><i>1471</i>&nbsp;            String[] content = event.split(MatchStory.STORY_SEPARATOR);</b>
<i>1472</i>&nbsp;
<b class="nc"><i>1473</i>&nbsp;            String player = content[0];</b>
<i>1474</i>&nbsp;
<b class="nc"><i>1475</i>&nbsp;            Type chosenWorkerType = new TypeToken&lt;int[]&gt;() {}.getType();</b>
<b class="nc"><i>1476</i>&nbsp;            int[] chosenWorker = new Gson().fromJson(content[1], chosenWorkerType);</b>
<i>1477</i>&nbsp;
<b class="nc"><i>1478</i>&nbsp;            Type actionType = new TypeToken&lt;CommunicationProtocol&gt;() {}.getType();</b>
<b class="nc"><i>1479</i>&nbsp;            CommunicationProtocol action = new Gson().fromJson(content[2], actionType);</b>
<i>1480</i>&nbsp;
<b class="nc"><i>1481</i>&nbsp;            Type destinationType = new TypeToken&lt;int[]&gt;() {}.getType();</b>
<b class="nc"><i>1482</i>&nbsp;            int[] destination = new Gson().fromJson(content[3], destinationType);</b>
<i>1483</i>&nbsp;
<b class="nc"><i>1484</i>&nbsp;            Platform.runLater(() -&gt; matchScene.playerView().writeStory(player, chosenWorker, action, destination));</b>
<b class="nc"><i>1485</i>&nbsp;        }</b>
<i>1486</i>&nbsp;    }
<i>1487</i>&nbsp;
<i>1488</i>&nbsp;    /**
<i>1489</i>&nbsp;     * This method tells who is the winner of the match
<i>1490</i>&nbsp;     * @param player Winner
<i>1491</i>&nbsp;     */
<i>1492</i>&nbsp;    @Override
<i>1493</i>&nbsp;    public void setWinner(PlayerProxy player) {
<b class="nc"><i>1494</i>&nbsp;        if(player.name.equals(nickname)){</b>
<b class="nc"><i>1495</i>&nbsp;            Platform.runLater(() -&gt; matchScene.winner(true));</b>
<b class="nc"><i>1496</i>&nbsp;            Platform.runLater(() -&gt; matchScene.playerView().changeMessage(&quot;You won the match&quot;));</b>
<i>1497</i>&nbsp;        } else {
<b class="nc"><i>1498</i>&nbsp;            Platform.runLater(() -&gt; matchScene.winner(false));</b>
<b class="nc"><i>1499</i>&nbsp;            Platform.runLater(() -&gt; matchScene.playerView().changeMessage(player.name + &quot; won the match&quot;));</b>
<i>1500</i>&nbsp;        }
<i>1501</i>&nbsp;    }
<i>1502</i>&nbsp;
<i>1503</i>&nbsp;    /**
<i>1504</i>&nbsp;     * This method tells if an opponent has lost the match (because of surrender or connection lost)
<i>1505</i>&nbsp;     * @param player Loser
<i>1506</i>&nbsp;     */
<i>1507</i>&nbsp;    @Override
<i>1508</i>&nbsp;    public void setLoser(PlayerProxy player) {
<b class="nc"><i>1509</i>&nbsp;        if(player.name.equals(nickname)){</b>
<b class="nc"><i>1510</i>&nbsp;            Platform.runLater(() -&gt; matchScene.winner(false));</b>
<i>1511</i>&nbsp;        } else {
<b class="nc"><i>1512</i>&nbsp;            Platform.runLater(() -&gt; matchScene.playerView().setLoser(player.name));</b>
<i>1513</i>&nbsp;        }
<i>1514</i>&nbsp;    }
<i>1515</i>&nbsp;
<i>1516</i>&nbsp;    /**
<i>1517</i>&nbsp;     * This method tells if player&#39;s time to do his action runs out
<i>1518</i>&nbsp;     */
<i>1519</i>&nbsp;    @Override
<i>1520</i>&nbsp;    public void timeOut() {
<b class="nc"><i>1521</i>&nbsp;        matchScene.setTimeoutLoser(true);</b>
<i>1522</i>&nbsp;    }
<i>1523</i>&nbsp;
<i>1524</i>&nbsp;    /**
<i>1525</i>&nbsp;     * This method shows error message of connection lost
<i>1526</i>&nbsp;     */
<i>1527</i>&nbsp;    @Override
<i>1528</i>&nbsp;    public synchronized void connectionLost() {
<b class="nc"><i>1529</i>&nbsp;        if(!inMenuPage &amp;&amp; !secondWindow) {</b>
<b class="nc"><i>1530</i>&nbsp;            connectedText.setVisible(false);</b>
<b class="nc"><i>1531</i>&nbsp;            connectedText.setManaged(false);</b>
<b class="nc"><i>1532</i>&nbsp;            disconnectionButton.setVisible(false);</b>
<b class="nc"><i>1533</i>&nbsp;            disconnectionButton.setManaged(false);</b>
<b class="nc"><i>1534</i>&nbsp;            loadingIcon.setVisible(true);</b>
<b class="nc"><i>1535</i>&nbsp;            loadingIcon.setManaged(true);</b>
<b class="nc"><i>1536</i>&nbsp;            errorMessage.setVisible(true);</b>
<b class="nc"><i>1537</i>&nbsp;            errorMessage.setManaged(true);</b>
<b class="nc"><i>1538</i>&nbsp;            enterGameButton.setVisible(false);</b>
<b class="nc"><i>1539</i>&nbsp;            enterGameButton.setManaged(false);</b>
<b class="nc"><i>1540</i>&nbsp;            restartConnection();</b>
<b class="nc"><i>1541</i>&nbsp;            setErrorMessage(&quot;Connection lost&quot;);</b>
<i>1542</i>&nbsp;        } else {
<b class="nc"><i>1543</i>&nbsp;            while (!inMenuPage) {</b>
<i>1544</i>&nbsp;                try {
<b class="nc"><i>1545</i>&nbsp;                    wait();</b>
<b class="nc"><i>1546</i>&nbsp;                } catch (InterruptedException e) {</b>
<b class="nc"><i>1547</i>&nbsp;                    e.printStackTrace();</b>
<b class="nc"><i>1548</i>&nbsp;                }</b>
<i>1549</i>&nbsp;            }
<b class="nc"><i>1550</i>&nbsp;            screenWidth = Screen.getPrimary().getBounds().getWidth();</b>
<b class="nc"><i>1551</i>&nbsp;            screenHeight = Screen.getPrimary().getBounds().getHeight();</b>
<b class="nc"><i>1552</i>&nbsp;            ipForm = new Text (&quot;Ip Address&quot;);</b>
<b class="nc"><i>1553</i>&nbsp;            portForm = new Text(&quot;Port Number&quot;);</b>
<b class="nc"><i>1554</i>&nbsp;            connectionButton = new Button(&quot;Connect&quot;);</b>
<b class="nc"><i>1555</i>&nbsp;            client.setRestart(true);</b>
<b class="nc"><i>1556</i>&nbsp;            showConnectionError();</b>
<i>1557</i>&nbsp;        }
<i>1558</i>&nbsp;    }
<i>1559</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2020-07-03 18:00</div>
</div>
</body>
</html>
